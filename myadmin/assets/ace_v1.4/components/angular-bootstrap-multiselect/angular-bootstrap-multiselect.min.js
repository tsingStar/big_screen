"use strict";angular.module("ui.multiselect",["multiselect.tpl.html"]).factory("optionParser",["$parse",function(n){var i=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(e){var t=e.match(i);if(!t)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+e+"'.");return{itemName:t[3],source:n(t[4]),viewMapper:n(t[2]||t[1]),modelMapper:n(t[1])}}}}]).directive("multiselect",["$parse","$document","$compile","$interpolate","optionParser",function(k,e,$,b,x){return{restrict:"E",require:"ngModel",link:function(i,e,t,n){function l(){h.items.length=0;var e=c.source(i);if(angular.isDefined(e)&&null!==e)for(var t=0;t<e.length;t++){var n={};n[c.itemName]=e[t],h.items.push({label:c.viewMapper(n),model:e[t],checked:!1})}}function r(){if(function(e){if(!0===e||!1===e)return!1;if(!e)return!0;if(e.length&&0<e.length)return!1;for(var t in e)if(e[t])return!1;return void 0===d||void 0===e[d]}(n.$modelValue))return h.header=t.msHeader||"Select",h.header;if(u)t.msSelected?h.header=b(t.msSelected)(h):h.header=n.$modelValue.length+" selected";else{var e={};e[c.itemName]=n.$modelValue,h.header=c.viewMapper(e)}}function a(e){var t;e?(t=[],angular.forEach(h.items,function(e){e.checked&&t.push(e.model)})):angular.forEach(h.items,function(e){return e.checked?(t=e.model,!1):void 0}),n.$setViewValue(t)}var o=t.options,c=x.parse(o),u=!!t.multiple,d=t.compareBy,s=t.scrollAfterRows,p=t.tabindex,f=t.maxWidth,m=!1,h=i.$new();h.filterAfterRows=t.filterAfterRows;var g=t.change||angular.noop;h.items=[],h.header="Select",h.multiple=u,h.disabled=!1,h.ulStyle={},void 0!==s&&parseInt(s).toString()===s&&(h.ulStyle={"max-height":26*s+14+"px","overflow-y":"auto","overflow-x":"hidden"}),void 0!==p&&parseInt(p).toString()===p&&(h.tabindex=p),void 0!==f&&parseInt(f).toString()===f&&(h.maxWidth={"max-width":f+"px"}),i.$on("$destroy",function(){h.$destroy()});var v=angular.element("<multiselect-popup></multiselect-popup>");(t.required||t.ngRequired)&&(m=!0),t.$observe("required",function(e){m=e}),h.$watch(function(){return k(t.disabled)(i)},function(e){h.disabled=e}),h.$watch(function(){return k(t.multiple)(i)},function(e){u=e||!1}),h.$watch(function(){return c.source(i)},function(e){angular.isDefined(e)&&l()},!0),h.$watch(function(){return n.$modelValue},function(e,t){angular.isDefined(e)&&(function(n){angular.isArray(n)?angular.forEach(h.items,function(t){t.checked=!1,angular.forEach(n,function(e){void 0===d&&angular.equals(t.model,e)?t.checked=!0:void 0!==d&&angular.equals(t.model[d],e[d])&&(t.checked=!0)})}):angular.forEach(h.items,function(e){e.checked=!1,void 0===d&&angular.equals(e.model,n)?e.checked=!0:void 0!==d&&null!==n&&angular.equals(e.model[d],n[d])&&(e.checked=!0)})}(e),h.$eval(g)),r(),n.$setValidity("required",h.valid())},!0),l(),e.append($(v)(h)),h.valid=function(){if(!m)return!0;var e=n.$modelValue;return angular.isArray(e)&&0<e.length||!angular.isArray(e)&&null!==e},h.checkAll=function(){u&&(angular.forEach(h.items,function(e){e.checked=!0}),a(!0))},h.uncheckAll=function(){angular.forEach(h.items,function(e){e.checked=!1}),a(!0)},h.select=function(e,t){!1===u?(function(e){e.checked||(h.uncheckAll(),e.checked=!e.checked),a(!1)}(t),h.toggleSelect()):(e.stopPropagation(),function(e){e.checked=!e.checked,a(!0)}(t))}}}}]).directive("multiselectPopup",["$document",function(r){return{restrict:"E",scope:!1,replace:!0,templateUrl:"multiselect.tpl.html",link:function(t,n,e){function i(e){l(e.target,n.find(e.target.tagName))||(n.removeClass("open"),r.unbind("click",i),t.$apply())}t.isVisible=!1,t.toggleSelect=function(){n.hasClass("open")?(t.filter="",n.removeClass("open"),r.unbind("click",i)):(t.filter="",n.addClass("open"),r.bind("click",i))};var l=function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1}}}}]),angular.module("multiselect.tpl.html",[]).run(["$templateCache",function(e){e.put("multiselect.tpl.html",'<div class="btn-group">\n  <button tabindex="{{tabindex}}" title="{{header}}" type="button" class="btn btn-default dropdown-toggle" ng-click="toggleSelect()" ng-disabled="disabled" ng-class="{\'error\': !valid()}">\n    <div ng-style="maxWidth" style="padding-right: 13px; overflow: hidden; text-overflow: ellipsis;">{{header}}</div><span class="caret" style="position:absolute;right:10px;top:14px;"></span>\n  </button>\n  <ul class="dropdown-menu" style="margin-bottom:30px;padding-left:5px;padding-right:5px;" ng-style="ulStyle">\n    <input ng-show="items.length > filterAfterRows" ng-model="filter" style="padding: 0px 3px;margin-right: 15px; margin-bottom: 4px;" placeholder="Type to filter options">    <li data-stopPropagation="true" ng-repeat="i in items | filter:filter">\n      <a ng-click="select($event, i)" style="padding:3px 10px;cursor:pointer;">\n        <i class="glyphicon" ng-class="{\'glyphicon-ok\': i.checked, \'empty\': !i.checked}"></i> {{i.label}}</a>\n    </li>\n  </ul>\n</div>')}]);