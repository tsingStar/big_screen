!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):e.hasOwnProperty("angular")?t(e.angular):"object"==typeof exports&&(module.exports=t(require("angular")))}(this,function(g){"use strict";function e(p){return function(){var f="ngStorage-";this.setKeyPrefix=function(e){if("string"!=typeof e)throw new TypeError("[ngStorage] - "+p+"Provider.setKeyPrefix() expects a String.");f=e};var l=g.toJson,d=g.fromJson;this.setSerializer=function(e){if("function"!=typeof e)throw new TypeError("[ngStorage] - "+p+"Provider.setSerializer expects a function.");l=e},this.setDeserializer=function(e){if("function"!=typeof e)throw new TypeError("[ngStorage] - "+p+"Provider.setDeserializer expects a function.");d=e},this.get=function(e){return d(window[p].getItem(f+e))},this.set=function(e,t){return window[p].setItem(f+e,l(t))},this.$get=["$rootScope","$window","$log","$timeout","$document",function(n,r,e,t,o){var i,a,s=f.length,c=function(e){var t;try{t=r[e]}catch(e){t=!1}if(t&&"localStorage"===e){var n="__"+Math.round(1e7*Math.random());try{localStorage.setItem(n,n),localStorage.removeItem(n)}catch(e){t=!1}}return t}(p)||(e.warn("This browser does not support Web Storage!"),{setItem:g.noop,getItem:g.noop,removeItem:g.noop}),u={$default:function(e){for(var t in e)g.isDefined(u[t])||(u[t]=g.copy(e[t]));return u.$sync(),u},$reset:function(e){for(var t in u)"$"===t[0]||delete u[t]&&c.removeItem(f+t);return u.$default(e)},$sync:function(){for(var e,t=0,n=c.length;t<n;t++)(e=c.key(t))&&f===e.slice(0,s)&&(u[e.slice(s)]=d(c.getItem(e)))},$apply:function(){var n;if(a=null,!g.equals(u,i)){for(var e in n=g.copy(i),g.forEach(u,function(e,t){g.isDefined(e)&&"$"!==t[0]&&(c.setItem(f+t,l(e)),delete n[t])}),n)c.removeItem(f+e);i=g.copy(u)}}};return u.$sync(),i=g.copy(u),n.$watch(function(){a||(a=t(u.$apply,100,!1))}),r.addEventListener&&r.addEventListener("storage",function(e){if(e.key){var t=o[0];t.hasFocus&&t.hasFocus()||f!==e.key.slice(0,s)||(e.newValue?u[e.key.slice(s)]=d(e.newValue):delete u[e.key.slice(s)],i=g.copy(u),n.$apply())}}),r.addEventListener&&r.addEventListener("beforeunload",function(){u.$apply()}),u}]}}return(g=g&&g.module?g:window.angular).module("ngStorage",[]).provider("$localStorage",e("localStorage")).provider("$sessionStorage",e("sessionStorage"))});