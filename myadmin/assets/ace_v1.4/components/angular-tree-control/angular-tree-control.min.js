"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="treeControl"),function(f){"use strict";f.module("treeControl",[]).constant("treeConfig",{templateUrl:null}).directive("treecontrol",["$compile",function(c){function p(e,o){return e?o?'class="'+e+'"':e:""}function u(e,o,n){e.hasOwnProperty(o)||(e[o]=n)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",selectedNodes:"=?",expandedNodes:"=?",onSelection:"&",onNodeToggle:"&",options:"=?",orderBy:"@",reverseOrder:"@",filterExpression:"=?",filterComparator:"=?"},controller:["$scope","$templateCache","$interpolate","treeConfig",function(i,e,o,n){function t(e,o){if(f.isArray(e)){o=o||[];for(var n=0;n<e.length;n++)o[n]=e[n]}else if(f.isObject(e))for(var t in o=o||{},e)!hasOwnProperty.call(e,t)||"$"===t.charAt(0)&&"$"===t.charAt(1)||(o[t]=e[t]);return o||e}function s(e){if(!i.options.multiSelection&&i.options.equality(e,i.selectedNode))return!0;if(i.options.multiSelection&&i.selectedNodes){for(var o=0;o<i.selectedNodes.length;o++)if(i.options.equality(e,i.selectedNodes[o]))return!0;return!1}}i.options=i.options||{},u(i.options,"multiSelection",!1),u(i.options,"nodeChildren","children"),u(i.options,"dirSelectable","true"),u(i.options,"injectClasses",{}),u(i.options.injectClasses,"ul",""),u(i.options.injectClasses,"li",""),u(i.options.injectClasses,"liSelected",""),u(i.options.injectClasses,"iExpanded",""),u(i.options.injectClasses,"iCollapsed",""),u(i.options.injectClasses,"iLeaf",""),u(i.options.injectClasses,"label",""),u(i.options.injectClasses,"labelSelected",""),u(i.options,"equality",function(e,o){return void 0!==e&&void 0!==o&&((e=t(e))[i.options.nodeChildren]=[],(o=t(o))[i.options.nodeChildren]=[],f.equals(e,o))}),u(i.options,"isLeaf",function(e){return!e[i.options.nodeChildren]||0===e[i.options.nodeChildren].length}),u(i.options,"allowDeselect",!0),u(i.options,"isSelectable",function(){return!0}),i.selectedNodes=i.selectedNodes||[],i.expandedNodes=i.expandedNodes||[],i.expandedNodesMap={};for(var d=0;d<i.expandedNodes.length;d++)i.expandedNodesMap[""+d]=i.expandedNodes[d];i.parentScopeOfTree=i.$parent,i.headClass=function(e){var o=p(i.options.injectClasses.liSelected,!1),n="";return o&&s(e)&&(n=" "+o),i.options.isLeaf(e)?"tree-leaf"+n:i.expandedNodesMap[this.$id]?"tree-expanded"+n:"tree-collapsed"+n},i.iBranchClass=function(){return p(i.expandedNodesMap[this.$id]?i.options.injectClasses.iExpanded:i.options.injectClasses.iCollapsed)},i.nodeExpanded=function(){return!!i.expandedNodesMap[this.$id]},i.selectNodeHead=function(){var e=this,o=void 0===i.expandedNodesMap[e.$id];if(i.expandedNodesMap[e.$id]=o?e.node:void 0,o)i.expandedNodes.push(e.node);else{for(var n,t=0;t<i.expandedNodes.length&&!n;t++)i.options.equality(i.expandedNodes[t],e.node)&&(n=t);void 0!==n&&i.expandedNodes.splice(n,1)}if(i.onNodeToggle){var s=e.$parent.node===e.synteticRoot?null:e.$parent.node;i.onNodeToggle({node:e.node,$parentNode:s,$index:e.$index,$first:e.$first,$middle:e.$middle,$last:e.$last,$odd:e.$odd,$even:e.$even,expanded:o})}},i.selectNodeLabel=function(e){var o=this;if(i.options.isLeaf(e)||i.options.dirSelectable&&i.options.isSelectable(e)){if(i.options.isLeaf(e)&&!i.options.isSelectable(e))return;var n=!1;if(i.options.multiSelection){for(var t=-1,s=0;s<i.selectedNodes.length;s++)if(i.options.equality(e,i.selectedNodes[s])){t=s;break}-1===t?(i.selectedNodes.push(e),n=!0):i.selectedNodes.splice(t,1)}else i.options.equality(e,i.selectedNode)&&i.options.allowDeselect?i.selectedNode=void 0:(i.selectedNode=e,n=!0);if(i.onSelection){var d=o.$parent.node===o.synteticRoot?null:o.$parent.node;i.onSelection({node:e,selected:n,$parentNode:d,$index:o.$index,$first:o.$first,$middle:o.$middle,$last:o.$last,$odd:o.$odd,$even:o.$even})}}else this.selectNodeHead()},i.selectedClass=function(){var e=s(this.node),o=p(i.options.injectClasses.labelSelected,!1),n="";return o&&e&&(n=" "+o),e?"tree-selected"+n:""},i.unselectableClass=function(){var e=!i.options.isSelectable(this.node),o=p(i.options.injectClasses.labelUnselectable,!1);return e?"tree-unselectable "+o:""},i.isReverse=function(){return!("false"===i.reverseOrder||"False"===i.reverseOrder||""===i.reverseOrder||!1===i.reverseOrder)},i.orderByFunc=function(){return"'"+i.orderBy+"'"};var l,r={orderBy:i.orderBy?" | orderBy:orderByFunc():isReverse()":"",ulClass:p(i.options.injectClasses.ul,!0),nodeChildren:i.options.nodeChildren,liClass:p(i.options.injectClasses.li,!0),iLeafClass:p(i.options.injectClasses.iLeaf,!1),labelClass:p(i.options.injectClasses.label,!1)},a=i.options.templateUrl||n.templateUrl;a&&(l=e.get(a)),l||(l='<ul {{options.ulClass}} ><li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liClass}}set-node-to-data><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i><i class="tree-leaf-head {{options.iLeafClass}}"></i><div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>'),this.template=c(o(l)({options:r}))}],compile:function(e,o,n){return function(l,t,e,o){l.$watch("treeModel",function(e){if(f.isArray(e)){if(f.isDefined(l.node)&&f.equals(l.node[l.options.nodeChildren],e))return;l.node={},l.synteticRoot=l.node,l.node[l.options.nodeChildren]=e}else{if(f.equals(l.node,e))return;l.node=e}}),l.$watchCollection("expandedNodes",function(e,o){var s=0,d={},n=t.find("li"),i=[];f.forEach(n,function(e){var o=f.element(e),n={$id:o.data("scope-id"),node:o.data("node")};i.push(n)}),f.forEach(e,function(e){for(var o=!1,n=0;n<i.length&&!o;n++){var t=i[n];l.options.equality(e,t.node)&&(d[t.$id]=t.node,o=!0)}o||(d[s++]=e)}),l.expandedNodesMap=d}),o.template(l,function(e){t.html("").append(e)}),l.$treeTransclude=n}}}}]).directive("setNodeToData",["$parse",function(e){return{restrict:"A",link:function(e,o,n){o.data("node",e.node),o.data("scope-id",e.$id)}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(e,o,n,t){t.template(e,function(e){o.html("").append(e)})}}}).directive("treeTransclude",function(){return{link:function(n,o,e,t){if(n.options.isLeaf(n.node)||f.forEach(n.expandedNodesMap,function(e,o){n.options.equality(e,n.node)&&(n.expandedNodesMap[n.$id]=n.node,n.expandedNodesMap[o]=void 0)}),!n.options.multiSelection&&n.options.equality(n.node,n.selectedNode))n.selectedNode=n.node;else if(n.options.multiSelection){for(var s=[],d=0;d<n.selectedNodes.length;d++)n.options.equality(n.node,n.selectedNodes[d])&&s.push(n.node);n.selectedNodes=s}n.transcludeScope=n.parentScopeOfTree.$new(),n.transcludeScope.node=n.node,n.transcludeScope.$parentNode=n.$parent.node===n.synteticRoot?null:n.$parent.node,n.transcludeScope.$index=n.$index,n.transcludeScope.$first=n.$first,n.transcludeScope.$middle=n.$middle,n.transcludeScope.$last=n.$last,n.transcludeScope.$odd=n.$odd,n.transcludeScope.$even=n.$even,n.$on("$destroy",function(){n.transcludeScope.$destroy()}),n.$treeTransclude(n.transcludeScope,function(e){o.empty(),o.append(e)})}}})}(angular);