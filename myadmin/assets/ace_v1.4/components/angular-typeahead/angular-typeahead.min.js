angular.module("siyfion.sfTypeahead",[]).directive("sfTypeahead",function(){return{restrict:"AC",require:"?ngModel",scope:{options:"=",datasets:"=",suggestionKey:"@"},link:function(o,r,e,c){function a(){if(t)r.typeahead(o.options,o.datasets),t=!1;else{var e=r.val();r.typeahead("destroy"),r.typeahead(o.options,o.datasets),c.$setViewValue(e),r.triggerHandler("typeahead:opened")}}function n(e,a,t){o.$apply(function(){var e=angular.isDefined(o.suggestionKey)?a[o.suggestionKey]:a;c.$setViewValue(e)})}var l=o.options||{},p=(angular.isArray(o.datasets)?o.datasets:[o.datasets])||[],t=!0;a(),o.$watch("options",a),angular.isArray(o.datasets)?o.$watchCollection("datasets",a):o.$watch("datasets",a),c.$parsers.push(function(e){if(angular.isObject(c.$modelValue)&&e===r.typeahead("val"))return c.$modelValue;var a=angular.isObject(e);return!1===l.editable?(c.$setValidity("typeahead",a),a?e:void 0):e}),c.$formatters.push(function(d){if(angular.isObject(d)){var u=!1;return $.each(p,function(a,e){function t(e){(function(e,t){var n=-1;return angular.forEach(e,function(e,a){angular.equals(t,e)&&(n=a)}),0<=n})(e,d)?(c.$setViewValue(d),u=!0):c.$setViewValue(!1===l.editable?void 0:d),!u&&a!==p.length-1||setTimeout(function(){o.$apply(function(){r.typeahead("val",s)})},0)}var n=e.source,i=e.displayKey||"value",s=(angular.isFunction(i)?i(d):d[i])||"";return!u&&(s?void n(s,t):void t([]))}),""}return null==d&&r.typeahead("val",null),d}),r.bind("typeahead:selected",function(e,a,t){n(0,a),o.$emit("typeahead:selected",a,t)}),r.bind("typeahead:autocompleted",function(e,a,t){n(0,a),o.$emit("typeahead:autocompleted",a,t)}),r.bind("typeahead:opened",function(){o.$emit("typeahead:opened")}),r.bind("typeahead:closed",function(){o.$emit("typeahead:closed")}),r.bind("typeahead:asyncrequest",function(){o.$emit("typeahead:asyncrequest")}),r.bind("typeahead:asynccancel",function(){o.$emit("typeahead:asynccancel")}),r.bind("typeahead:asyncreceive",function(){o.$emit("typeahead:asyncreceive")}),r.bind("typeahead:cursorchanged",function(e,a,t){o.$emit("typeahead:cursorchanged",e,a,t)})}}});