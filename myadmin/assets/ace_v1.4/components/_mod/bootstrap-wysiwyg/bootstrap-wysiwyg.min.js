!function(m){"use strict";m.fn.cleanHtml=function(){var t=m(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},m.fn.wysiwyg=function(t){function i(){n.activeToolbarClass&&m(n.toolbarSelector).find(d).each(function(){try{var t=m(this).data(n.commandRole);document.queryCommandState(t)?m(this).addClass(n.activeToolbarClass):m(this).removeClass(n.activeToolbarClass)}catch(t){}})}function o(t,e){var n=t.split(" "),o=n.shift(),a=n.join(" ")+(e||"");document.execCommand(o,0,a),i()}function a(){try{var t=window.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}catch(t){}}function r(){e=a()}function l(){try{var t=window.getSelection();if(e){try{t.removeAllRanges()}catch(t){document.body.createTextRange().select(),document.selection.empty()}t.addRange(e)}}catch(t){}}function c(t){f.focus(),m.each(t,function(t,e){/^image\//.test(e.type)?m.when(function(t){var e=m.Deferred(),n=new FileReader;return n.onload=function(t){e.resolve(t.target.result)},n.onerror=e.reject,n.onprogress=e.notify,n.readAsDataURL(t),e.promise()}(e)).done(function(t){o("insertimage",t)}).fail(function(t){n.fileUploadError("file-reader",t)}):n.fileUploadError("unsupported-file-type",e.type)})}function s(t,e){l(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,e||"transparent"),r(),t.data(n.selectionMarker,e)}var e,n,d,u,f=this;return n=m.extend({},m.fn.wysiwyg.defaults,t),d="a[data-"+n.commandRole+"],button[data-"+n.commandRole+"],input[type=button][data-"+n.commandRole+"]",u=n.hotKeys,m.each(u,function(t,e){f.keydown(t,function(t){f.attr("contenteditable")&&f.is(":visible")&&(t.preventDefault(),t.stopPropagation(),o(e))}).keyup(t,function(t){f.attr("contenteditable")&&f.is(":visible")&&(t.preventDefault(),t.stopPropagation())})}),n.dragAndDropImages&&f.on("dragenter dragover",!1).on("drop",function(t){var e=t.originalEvent.dataTransfer;t.stopPropagation(),t.preventDefault(),e&&e.files&&0<e.files.length&&c(e.files)}),function(t,e){t.find(d).click(function(){l(),f.focus(),o(m(this).data(e.commandRole)),r()}),t.find("[data-toggle=dropdown]").click(l);var n=!!window.navigator.msPointerEnabled||!!document.all&&!!document.addEventListener;t.find("input[type=text][data-"+e.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",l(),t&&(f.focus(),o(m(this).data(e.commandRole),t)),r()}).on("focus",function(){if(!n){var t=m(this);t.data(e.selectionMarker)||(s(t,e.selectionColor),t.focus())}}).on("blur",function(){if(!n){var t=m(this);t.data(e.selectionMarker)&&s(t,!1)}}),t.find("input[type=file][data-"+e.commandRole+"]").change(function(){l(),"file"===this.type&&this.files&&0<this.files.length&&c(this.files),r(),this.value=""})}(m(n.toolbarSelector),n),f.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){r(),i()}),m(window).bind("touchend",function(t){var e=f.is(t.target)||0<f.has(t.target).length,n=a();n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&!e||(r(),i())}),this},m.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(t,e){console.log("File upload error",t,e)}}}(window.jQuery);