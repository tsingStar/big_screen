!function(s){"use strict";function i(e,t){this.element=s(e),this.options=s.extend(!0,{},s.fn.tag.defaults,t),this.values=s.grep(s.map(this.element.val().split(","),s.trim),function(e){return 0<e.length}),this.show()}i.prototype={constructor:i,show:function(){var a=this;a.element.parent().prepend(a.element.detach().hide()),a.element.wrap(s('<div class="tags">')).parent().on("click",function(){a.input.focus()}),a.values.length&&s.each(a.values,function(){a.createBadge(this)}),a.input=s('<input type="text">').attr("placeholder",a.options.placeholder).insertAfter(a.element).on("focus",function(){a.element.parent().addClass("tags-hover")}).on("blur",function(){a.skip||(a.process(),a.element.parent().removeClass("tags-hover"),a.element.siblings(".tag").removeClass("tag-important")),a.skip=!1}).on("keydown",function(e){if(188==e.keyCode||13==e.keyCode||9==e.keyCode)!s.trim(s(this).val())||a.element.siblings(".typeahead").length&&!a.element.siblings(".typeahead").is(":hidden")?188==e.keyCode&&(a.options.autocompleteOnComma?(!a.element.siblings(".typeahead").length||a.element.siblings(".typeahead").is(":hidden")||(a.input.data("bs_typeahead").select(),e.stopPropagation()),e.preventDefault()):(e.preventDefault(),a.process())):(9!=e.keyCode&&e.preventDefault(),a.process());else if(s.trim(s(this).val())||8!=e.keyCode)a.element.siblings(".tag").removeClass("tag-important");else{var t=a.element.siblings(".tag").length;if(t){var n=a.element.siblings(".tag:eq("+(t-1)+")");n.hasClass("tag-important")?a.remove(t-1):n.addClass("tag-important")}}}).bs_typeahead({source:a.options.source,matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())&&(-1==a.inValues(e)||a.options.allowDuplicates)},updater:s.proxy(a.add,a)}),s(a.input.data("bs_typeahead").$menu).on("mousedown",function(){a.skip=!0}),this.element.trigger("shown")},inValues:function(n){if(this.options.caseInsensitive){var a=-1;return s.each(this.values,function(e,t){return t.toLowerCase()==n.toLowerCase()?(a=e,!1):void 0}),a}return s.inArray(n,this.values)},createBadge:function(e){var t=this;s("<span/>",{class:"tag"}).text(e.toString()).append(s('<button type="button" class="close">&times;</button>').on("click",function(){t.remove(t.element.siblings(".tag").index(s(this).closest(".tag")))})).insertBefore(t.element)},add:function(e){var t=this;if(!t.options.allowDuplicates){var n=t.inValues(e);if(-1!=n){var a=t.element.siblings(".tag:eq("+n+")");return a.addClass("tag-warning"),void setTimeout(function(){s(a).removeClass("tag-warning")},500)}}this.values.push(e),this.createBadge(e),this.element.val(this.values.join(", ")),this.element.trigger("added",[e])},remove:function(e){if(0<=e){var t=this.values.splice(e,1);this.element.siblings(".tag:eq("+e+")").remove(),this.element.val(this.values.join(", ")),this.element.trigger("removed",[t])}},process:function(){var e=s.grep(s.map(this.input.val().split(","),s.trim),function(e){return 0<e.length}),t=this;s.each(e,function(){t.add(this)}),this.input.val("")},skip:!1};var e=s.fn.tag;s.fn.tag=function(a){return this.each(function(){var e=s(this),t=e.data("tag"),n="object"==typeof a&&a;t||e.data("tag",t=new i(this,n)),"string"==typeof a&&t[a]()})},s.fn.tag.defaults={allowDuplicates:!1,caseInsensitive:!0,autocompleteOnComma:!1,placeholder:"",source:[]},s.fn.tag.Constructor=i,s.fn.tag.noConflict=function(){return s.fn.tag=e,this},s(window).on("load",function(){s('[data-provide="tag"]').each(function(){var e=s(this);e.data("tag")||e.tag(e.data())})})}(window.jQuery);