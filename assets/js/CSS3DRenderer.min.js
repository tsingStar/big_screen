THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DObject.prototype.constructor=THREE.CSS3DObject,THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite,THREE.CSS3DRenderer=function(){var r,n,o,i;console.log("THREE.CSS3DRenderer",THREE.REVISION);var d=new THREE.Matrix4,p={camera:{fov:0,style:""},objects:new WeakMap},s=document.createElement("div");s.style.overflow="hidden",this.domElement=s;var m=document.createElement("div");m.style.WebkitTransformStyle="preserve-3d",m.style.transformStyle="preserve-3d",s.appendChild(m);var E=/Trident/i.test(navigator.userAgent);function a(e){return Math.abs(e)<1e-10?0:e}function l(e){var t=e.elements;return"matrix3d("+a(t[0])+","+a(-t[1])+","+a(t[2])+","+a(t[3])+","+a(t[4])+","+a(-t[5])+","+a(t[6])+","+a(t[7])+","+a(t[8])+","+a(-t[9])+","+a(t[10])+","+a(t[11])+","+a(t[12])+","+a(-t[13])+","+a(t[14])+","+a(t[15])+")"}function S(e,t){var r=e.elements,n="matrix3d("+a(r[0])+","+a(r[1])+","+a(r[2])+","+a(r[3])+","+a(-r[4])+","+a(-r[5])+","+a(-r[6])+","+a(-r[7])+","+a(r[8])+","+a(r[9])+","+a(r[10])+","+a(r[11])+","+a(r[12])+","+a(r[13])+","+a(r[14])+","+a(r[15])+")";return E?"translate(-50%,-50%)translate("+o+"px,"+i+"px)"+t+n:"translate(-50%,-50%)"+n}this.getSize=function(){return{width:r,height:n}},this.setSize=function(e,t){o=(r=e)/2,i=(n=t)/2,s.style.width=e+"px",s.style.height=t+"px",m.style.width=e+"px",m.style.height=t+"px"};var c,u,v=(c=new THREE.Vector3,u=new THREE.Vector3,function(e,t){return c.setFromMatrixPosition(e.matrixWorld),u.setFromMatrixPosition(t.matrixWorld),c.distanceToSquared(u)});function h(e){for(var t=function(e){var t=[];return e.traverse(function(e){e instanceof THREE.CSS3DObject&&t.push(e)}),t}(e).sort(function(e,t){return p.objects.get(e).distanceToCameraSquared-p.objects.get(t).distanceToCameraSquared}),r=t.length,n=0,a=t.length;n<a;n++)t[n].element.style.zIndex=r-n}this.render=function(e,t){var r=t.projectionMatrix.elements[5]*i;p.camera.fov!==r&&(t.isPerspectiveCamera&&(s.style.WebkitPerspective=r+"px",s.style.perspective=r+"px"),p.camera.fov=r),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld();var n=t.isOrthographicCamera?"scale("+r+")"+l(t.matrixWorldInverse):"translateZ("+r+"px)"+l(t.matrixWorldInverse),a=n+"translate("+o+"px,"+i+"px)";p.camera.style===a||E||(m.style.WebkitTransform=a,m.style.transform=a,p.camera.style=a),function e(t,r,n){if(t instanceof THREE.CSS3DObject){var a;a=t instanceof THREE.CSS3DSprite?(d.copy(r.matrixWorldInverse),d.transpose(),d.copyPosition(t.matrixWorld),d.scale(t.scale),d.elements[3]=0,d.elements[7]=0,d.elements[11]=0,d.elements[15]=1,S(d,n)):S(t.matrixWorld,n);var o=t.element,i=p.objects.get(t);if(void 0===i||i!==a){o.style.WebkitTransform=a;var s={style:o.style.transform=a};E&&(s.distanceToCameraSquared=v(r,t)),p.objects.set(t,s)}o.parentNode!==m&&m.appendChild(o)}for(var l=0,c=t.children.length;l<c;l++)e(t.children[l],r,n)}(e,t,n),E&&h(e)}};