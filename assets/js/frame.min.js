requirejs.config({baseUrl:".",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys",metapc:"/assets/js/meta-pc.min",barrager:"/assets/plugs/jquery.barrager.js/dist/js/jquery.barrager.min",countup:"/assets/plugs/countUp.js/dist/countUp.min",countupjq:"/assets/js/countUp-jquery.min",fullscreen:"/assets/plugs/private-face-jquery.fullscreen-24f370e/release/jquery.fullscreen-0.4.1.min",introjs:"/assets/plugs/intro.js-master/minified/intro.min",animatejs:"/assets/js/jquery.animate.min"},shim:{bindhotkeys:{deps:["hotkeys"]},countup:{exports:"CountUp"},countupjq:{deps:["jquery","countup"]},barrager:{deps:["jquery"]},fullscreen:{deps:["jquery"]},animatejs:{deps:["jquery"]}}}),requirejs(["jquery","metapc","countup","introjs","countupjq","barrager","hotkeys","bindhotkeys","fullscreen","animatejs"],function(h,n,o,v){h(document).ready(function(){C.init(),h(".load-container").fadeOut(500,function(){var n=null==window.localStorage.introstep?0:window.localStorage.introstep;parseInt(n)<2&&(v().setOptions(b).start().onexit(t),window.localStorage.introstep=2)})});var b={nextLabel:"下一条",prevLabel:"上一条",skipLabel:"跳过提示",doneLabel:"我看完了",exitOnOverlayClick:!1,overlayOpacity:.3,showStepNumbers:!1};function t(n){console.log(n)}var e,i,s=function(){var t,o,i=0,e=0,s=[],a=0,c=h(window).height();function n(){l(1).done(function(n){0<n.ret&&(h("body").barrager.removeAll(),clearTimeout(t),clearTimeout(o))}).fail(function(){})}function r(){var n;if(1==danmuconfig.isloop&&(n=s.shift()),2==danmuconfig.isloop)if(s.length>danmuconfig.historynum)n=s.shift();else{if(!(0<s.length))return void(o=setTimeout(function(){r()},1e3*danmuconfig.looptime));var t=s.length<danmuconfig.historynum?s.length:danmuconfig.historynum;n=s[e%t],e=e%t+1}n&&(n.speed=15+5*Math.random(),n.bottom=a+Math.random()*(4==danmuconfig.positionmode?c:c/3),h("body").barrager(n)),o=setTimeout(function(){r()},1e3*danmuconfig.looptime)}function u(){d().done(function(n){if(0==n.ret)for(var t=0,o=n.data.length;t<o;t++){var e={};e.img=n.data[t].avatar,1==danmuconfig.showname?e.info=n.data[t].content:e.info=n.data[t].nick_name+"："+n.data[t].content,e.close=!1,e.color=danmuconfig.textcolor,e.old_ie_color=danmuconfig.textcolor,s.push(e),i=i>n.data[t].shenhetime?i:n.data[t].shenhetime}1==n.ret&&(i=n.lasttime)}).always(function(){t=setTimeout(function(){u()},1e4)})}1==danmuconfig.positionmode&&(a=c/3*2),2==danmuconfig.positionmode&&(a=c/3);function l(n){return h.ajax({url:"wall/ajax_act_danmu_config.php",data:{danmuswitch:n},type:"get",dataType:"json"})}var d=function(){return h.ajax({url:"wall/ajax_act_get_danmu.php",data:{shenhetime:i},type:"get",dataType:"json"})};return{toggle:function(){1==danmuconfig.danmuswitch?(l(2).done(function(n){0<n.ret&&(u(),r())}).fail(function(){}),danmuconfig.danmuswitch=2):(n(),danmuconfig.danmuswitch=1)},init:function(){2==danmuconfig.danmuswitch&&(u(),r())},status:function(){return danmuconfig.danmuswitch}}}(),a=(e=window.sessionStorage,i=h("#bgmusic"),e.bgmusic="",{init:function(){c()},changeBgMusic:function(n,t){!function(n,t){e.bgmusic=n+"|"+t.toString()}(n,t)},status:function(){return window.sessionStorage.bgmusic.split("|")[1]},toggle:function(){var n=e.bgmusic.split("|");1==n[1]?e.bgmusic=n[0]+"|2":e.bgmusic=n[0]+"|1"}});function c(){MUSIC[CURRENTPLUG]?e.bgmusic=""==e.bgmusic?MUSIC[CURRENTPLUG].bgmusicpath+"|"+MUSIC[CURRENTPLUG].bgmusicstatus:e.bgmusic:""==e.bgmusic&&(e.bgmusic="/wall/themes/meepo/assets/music/Radetzky_Marsch.mp3|2"),function(n){var t=n.split("|");i.find("source").attr("src",t[0]),status=t[1],2==t[1]?function(n){n.pause()}(i[0]):function n(t){var o=t.currentSrc;var e=h(t).find("source").attr("src");-1==o.indexOf(e)&&t.load();1==t.paused&&(setTimeout(function(){n(t)},1e3),t.play())}(i[0])}(e.bgmusic),setTimeout(c,500)}var r,u,l=(r=window.sessionStorage,u="",{init:function(){d()},changeBg:function(n){!function(n){r.bgpath=n}(n)}});function d(){BACKGROUNDIMAGE[CURRENTPLUG]?r.bgpath=BACKGROUNDIMAGE[CURRENTPLUG].path:""==u&&(r.bgpath="/wall/themes/meepo/assets/images/defaultbg.jpg"),u!=r.bgpath&&function(n){var t=h("#bg1"),o=h("#bg2"),e=t.find("video"),i=o.find("video"),s=n.substr(-4);t.css({opacity:0}),o.css({opacity:1}),""!=i.attr("src")&&(i.remove(),e.appendTo(o));if((e=t.find("video")).length<=0){h('<video src="" style="object-fit:fill;" autoplay="true" autobuffer autoloop loop width="100%" height="100%"></video>').appendTo(t),e=t.find("video")}if(".mp4"==s.toLowerCase())e.attr("src",n),t.css({"background-image":""}),e.on("loadeddata",function(){1==e[0].paused&&!function n(t){var o=t.currentSrc;var e=h(t).attr("src");if(""==e)return;-1==o.indexOf(e)&&t.load();1==t.paused&&(setTimeout(function(){n(t)},1e3),t.play())}(e[0]),t.css({opacity:1}),t.animateControl("fadeIn",function(){o.css({"background-image":"",opacity:0}),i.attr("src",n)})});else{var a=new Image;a.src=n,e.attr("src",""),f(e[0]),h(a).on("load",function(){t.css({opacity:1}),t.css({"background-image":"url("+n+")"}).animateControl("fadeIn",function(){o.css({"background-image":"url("+n+")",opacity:0}),i.attr("src",""),f(i[0])})})}}(u=r.bgpath),setTimeout(d,500)}function f(n){n&&n.pause()}var m,p,w,g=function(){storage=window.localStorage;var t=h("#box");function o(n){t.find("img").attr("src",n)}return storage.showqrcode&&2==storage.showqrcode?(t.hide(),storage.showqrcode=2):storage.showqrcode=1,o(""==customqrcode?"./wall/defaultqrcode.php?from="+CURRENTPLUG:customqrcode),{toggle:function(){storage.showqrcode=1==storage.showqrcode?2:1,t.toggle()},resize:function(n){t.resizeQrcodeBox(n)},change:function(n){o(n)},status:function(){return storage.showqrcode}}}(),y=function(){function n(){var t=new o("counter",0,{prefix:"参与人数：",suffix:"人"});t.start(),null==countsignperson_timer&&(countsignperson_timer=setInterval(function(){h.ajax({url:"/wall/ajax_act_frame.php?action=countperson",type:"get",dataType:"json"}).done(function(n){0<n.code?t.update(n.data):h("#counter").text("无数据")}).fail(function(){h("#counter").text("无数据")})},1e3))}countsignperson_timer=null;return{init:function(){n()}}}(),C={init:function(){K.init(),x(),l.init(),a.init(),P.init(),y.init(),s.init(),window.minibar.init(),h(window).on("resize",function(){x()})}};function x(){g.resize(QRCODEPOS),h("iframe").height(window.innerHeight)}function _(n){return p.replace("{{classname}}",m[n].classname).replace("{{title}}",m[n].title).replace("{{icon}}",m[n].icon)}function j(n){var t=h.extend({},n),o=!1;if(w.html(""),t.btn_start){var e=_("start"),i=h(e);i.css({cursor:"pointer"}),i.on("click",t.btn_start),i.appendTo(w),o=!0}if(t.btn_stop){var s=_("stop"),a=h(s);a.css({cursor:"pointer"}),a.on("click",t.btn_stop),a.appendTo(w),o=!0}if(t.btn_reset){var c=_("reset"),r=h(c);r.css({cursor:"pointer"}),r.on("click",t.btn_reset),r.appendTo(w),o=!0}if(t.btn_prev){var u=_("prev"),l=h(u);l.css({cursor:"pointer"}),l.on("click",t.btn_prev),l.appendTo(w),o=!0}if(t.btn_next){var d=_("next"),f=h(d);f.css({cursor:"pointer"}),f.on("click",t.btn_next),f.appendTo(w),o=!0}if(t.btn_result){var m=_("result"),p=h(m);p.css({cursor:"pointer"}),p.on("click",t.btn_result),p.appendTo(w),o=!0}if(o){w.show();var g=window.localStorage.introstep;parseInt(g)<3&&(v().setOptions(b).goToStepNumber(3).start().oncomplete(function(){h("#helperaudio")[0].pause()}),h("#helperaudio")[0].play(),window.localStorage.introstep=3)}else w.hide()}window.minibar=(m={start:{title:"开始",classname:"navbar-btn z-s btn-start",icon:"icon iconfont iconks"},reset:{title:"重玩",classname:"navbar-btn z-s btn-reset",icon:"icon iconfont iconcw"},stop:{title:"停止",classname:"navbar-btn z-s btn-stop",icon:"icon iconfont icontingzhi"},prev:{title:"上一轮",classname:"navbar-btn z-s btn-prev",icon:"icon iconfont iconsyl"},next:{title:"下一轮",classname:"navbar-btn z-s btn-next",icon:"icon iconfont iconxyl"},result:{title:"结果",classname:"navbar-btn z-s btn-result",icon:"icon iconfont iconphb"}},p='<div class="{{classname}}"><div><span title="{{title}}" class="{{icon}}"></span></div></div>',w=h(".navbar-s"),{init:function(n){j(n)}}),window.roundbar=function(){var i=h(".subnav");function s(){i.find("li").html("")}return{init:function(n){!function(n){if(s(),n.length<=0)i.hide();else{for(var t="",o=0,e=n.length;o<e;o++)t+='<section class="z z-s" data="'+n[o].action+'"><div><span title="'+n[o].name+'" class="icon iconfont '+n[o].icon+'" style="opacity:'+(1==n[o].current?"1":"0.5")+';"></span></div> </section>';h(t).appendTo(i.find("li")),i.find("section").on("click",function(n){n.preventDefault(),h("#frame").animateControl("zoomIn"),h("iframe").attr("src",h(this).attr("data"))}),i.show()}}(n),function(){var n=h(".menu-item.active"),t=n.width(),o=n.offset().left,e=i.find("li").outerWidth();i.find("li").css({left:o-e/2+t/2+"px"})}()},clear:function(){s(),i.hide()}}};var k,q,T,U,S,z,R,G,I,M,O,L,P=(k=h(".navbar"),q=k.find(".menu-item"),T=k.find(".btn-fullscreen"),U=k.find(".btn-qrcode"),S=k.find(".btn-music"),z=k.find(".btn-danmu"),R=k.find(".btn-admin"),G=h(".subnav"),I=!1,O=M=null,L="",{init:function(){n.init(4096,14,4096),E(),function(){for(var n=0,t=q.length;n<t;n++){var o=h(q[n]).attr("data");h(q[n]).find("span").addClass(icons[o])}1==g.status()?(U.find(".iconfont").removeClass("iconewmgb"),U.find(".iconfont").addClass("iconewm")):(U.find(".iconfont").removeClass("iconewm"),U.find(".iconfont").addClass("iconewmgb")),1==s.status()?(z.find(".iconfont").removeClass("icondmkq"),z.find(".iconfont").addClass("icondmgb")):(z.find(".iconfont").removeClass("icondmgb"),z.find(".iconfont").addClass("icondmkq"))}(),q.on("click",function(n){n.preventDefault();var t=h(this).attr("data");h(this).siblings().removeClass("active"),h(this).addClass("active"),window.roundbar().clear(),N(t)}),U.on("click",function(){h(this).find(".iconfont").hasClass("iconewmgb")?(h(this).find(".iconfont").removeClass("iconewmgb"),h(this).find(".iconfont").addClass("iconewm")):(h(this).find(".iconfont").removeClass("iconewm"),h(this).find(".iconfont").addClass("iconewmgb")),g.toggle()}),z.on("click",function(){h(this).find(".iconfont").hasClass("icondmgb")?(h(this).find(".iconfont").removeClass("icondmgb"),h(this).find(".iconfont").addClass("icondmkq")):(h(this).find(".iconfont").removeClass("icondmkq"),h(this).find(".iconfont").addClass("icondmgb")),s.toggle()}),T.on("click",function(n){h.fullscreen.isFullScreen()?(h(this).find(".iconfont").removeClass("iconsp"),h(this).find(".iconfont").addClass("iconqp"),h.fullscreen.exit()):(h(this).find(".iconfont").removeClass("iconqp"),h(this).find(".iconfont").addClass("iconsp"),h("body").fullscreen()),n.preventDefault()}),S.on("click",function(n){h(this).find(".iconfont").hasClass("iconyygb")?(h(this).find(".iconfont").removeClass("iconyygb"),h(this).find(".iconfont").addClass("iconyinle")):(h(this).find(".iconfont").removeClass("iconyinle"),h(this).find(".iconfont").addClass("iconyygb")),a.toggle()}),R.on("click",function(){window.open("./myadmin/")}),k.on("mouseenter",function(n){clearTimeout(M),0==I&&(k.css({opacity:1}),""!=h(".subnav li").html()&&h(".subnav").show(),I=!0)}),G.on("mouseenter",function(n){clearTimeout(M),0==I&&(k.css({opacity:1}),""!=h(".subnav li").html()&&h(".subnav").show(),I=!0)}),k.on("mouseleave",function(){0!=I&&(M=setTimeout(function(){k.animate({opacity:0},"fast","linear",function(){h(".subnav").fadeOut(500),I=!1})},3e3))}),G.on("mouseleave",function(){0!=I&&(M=setTimeout(function(){k.animate({opacity:0},"fast","linear",function(){h(".subnav").fadeOut(500),I=!1})},3e3))}),h.each(PLUGS,function(o,n){""!=n.hotkey&&hotkeys(n.hotkey,function(n,t){n.preventDefault(),N(o)})}),hotkeys("ctrl+o,ctrl+d,ctrl+s",function(n,t){switch(n.preventDefault(),t.key){case"ctrl+o":U.trigger("click");break;case"ctrl+d":z.trigger("click");break;case"ctrl+s":S.trigger("click")}}),function(){var n=.04*k.width();h(".right-item").css({width:n+"px"})}()}});function E(){1==a.status()?(S.find(".iconfont").removeClass("iconyygb"),S.find(".iconfont").addClass("iconyinle")):(S.find(".iconfont").removeClass("iconyinle"),S.find(".iconfont").addClass("iconyygb")),clearTimeout(O),O=setTimeout(E,500)}function N(n){CURRENTPLUG=n,BACKGROUNDIMAGE[n]?l.changeBg(BACKGROUNDIMAGE[n].path):l.changeBg("/wall/themes/meepo/assets/images/defaultbg.jpg"),MUSIC[n]?a.changeBgMusic(MUSIC[n].bgmusicpath,MUSIC[n].bgmusicstatus):a.changeBgMusic("/wall/themes/meepo/assets/music/Radetzky_Marsch.mp3",2),h("iframe").attr("src",PLUGS[n].url),""==L?h("#frame").animateControl("zoomIn"):PLUGS[n].ordernum<PLUGS[L].ordernum?h("#frame").animateControl("slideInLeft"):PLUGS[n].ordernum>PLUGS[L].ordernum?h("#frame").animateControl("slideInRight"):h("#frame").animateControl("zoomIn"),g.change(""==customqrcode?"./wall/defaultqrcode.php?from="+n:customqrcode),window.minibar.init({}),L=n}var B,D,A,$,Q,X,K=(B=window.localStorage,D=h(".loginformbg"),A=h(".loginform"),{init:function(){"1"!=B.loginstatus?Y():F()}});function Y(){h(".button-login").on("click",function(){(function(n){return h.ajax({url:"wall/login.do.php",data:{password:n},type:"get",dataType:"json"})})(h("#password").val()).done(function(n){0<n.code?(F(),B.loginstatus=1):(A.addClass("shake_effect"),setTimeout(function(){A.removeClass("shake_effect")},2e3))})})}function F(){D.fadeOut(500)}function H(n,t){this.$element=n,this.defaults={w:90,h:90,y:18,x:$(Q).width()-118},this.options=$.extend({},this.defaults,t)}$=jQuery,Q=window,X=document,H.prototype={resize:function(){var o=this;$(X).mousemove(function(n){if(this.move){var t=X.move_target?X.move_target.posix:{x:0,y:0};(X.call_down||function(){$(this.move_target).css({top:n.pageY-t.y,left:n.pageX-t.x}),o.coorpos()}).call(this,n,t)}}).mouseup(function(n){if($("iframe").removeClass("disableiframe"),this.move){(X.call_up||function(){}).call(this,n),$.extend(this,{move:!1,move_target:null,call_down:!1,call_up:!1});var t={w:e.width(),h:e.height(),x:e.position().left,y:e.position().top};o.coorpos(),o.ajax_set_qrcodepos(t)}}).mousedown(function(n){$("iframe").addClass("disableiframe");for(var t=(n=n||Q.event).target||n.srcElement;t;){if(t.id&&"box"==t.id)return void o.coorpos();t=t.parentNode}$(".coor").css("display","none")});var e=this.$element.mousedown(function(n){$(".coor").css({display:"block"});var t=$(this).offset();this.posix={x:n.pageX-t.left,y:n.pageY-t.top},$.extend(X,{move:!0,move_target:this})}).on("mousedown",".coor-right-bottom",function(n){o.set_call_down(n,1,1)}).on("mousedown",".coor-bottom",function(n){o.set_call_down(n,0,1)}).on("mousedown",".coor-right",function(n){o.set_call_down(n,1,0)}).css({width:o.options.w,height:o.options.h,top:o.options.y,left:o.options.x})},set_call_down:function(n,t,o){var e=this,i=this.$element,s=i.width(),a=i.height(),c=n.pageX,r=n.pageY;return $.extend(X,{move:!0,call_down:function(n){1==t&&1==o?i.css({width:Math.max(80,n.pageX-c+s),height:Math.max(80,n.pageX-c+s)}):i.css({width:t?Math.max(80,n.pageX-c+s):i.width(),height:o?Math.max(80,n.pageY-r+a):i.height()}),e.coorpos()}}),!1},coorpos:function(){var n=$(this.$element).find("span");if(""==n.html())n.remove();else{var t=$(this.$element).width();n.css({"font-size":t/16+"px"});var o=$(this.$element).height(),e=$(".qrcode").position().top;$(".coor-bottom").css({top:o+e-3+"px"}),$(".coor-right").css({top:e+o/2-3+"px"}),$(".coor-right-bottom").css({top:e+o-3+"px"})}},ajax_set_qrcodepos:function(n){$.ajax({type:"POST",url:"/wall/ajax_act_set_qrcodepos.php",data:n,dataType:"json",success:function(n){0<n.code&&(QRCODEPOS=n.data)}})},toggle_qrocde:function(){this.$element.toggle()}},$.fn.resizeQrcodeBox=function(n){var t=$(Q).width(),o=$(Q).height(),e={w:90,h:90,y:18,x:$(Q).width()-118},i=(n=$.extend({},e,n),$.extend({},n));n.x<0&&(i.x=0),n.y<0&&(i.y=0),n.x+n.w>t&&(i.x=t-n.w-20),n.y+n.h>o&&(i.y=o-n.h-20);var s=$(this).find("img");function a(n){n.preventDefault()}return s.on("click",a),s.on("mousedown",a),s.on("mousemove",a),s.on("mouseup",a),$(this).find("span").css({"font-size":i.w/16+"px"}),new H(this,i).resize()},$.fn.toggleQrcode=function(){return new H(this,options).toggle_qrocde()}});