var WEB_URL="themes/meepo/assets/",Track={tracklist_elm:null,track_elm:null,width:0,height:0,size:0,init:function(){null==this.tracklist_elm&&(this.tracklist_elm=$(".Panel.Track .tracklist"),this.track_elm=this.tracklist_elm.children()),this.height=1==THEME_INFO.themedata.ishorizontal?this.tracklist_elm.height()/10:this.tracklist_elm.height(),this.width=1==THEME_INFO.themedata.ishorizontal?this.tracklist_elm.width()-this.height:this.tracklist_elm.width()/10,this.size=this.height>this.width?this.width:this.height;var t,e=null,a=null;e=1==THEME_INFO.themedata.ishorizontal?(a={background:"url("+THEME_INFO.themedata.startline_path+") repeat-y left center","background-size":"10px auto"},{background:"url("+THEME_INFO.themedata.endline_path+") repeat-y center center","background-size":"45px auto;"}):(a={background:"url("+THEME_INFO.themedata.startline_path+") repeat-x left bottom"},{background:"url("+THEME_INFO.themedata.endline_path+") repeat-x center center"}),t={background:"url("+THEME_INFO.themedata.trackodd_path+") repeat"},trackeven_css={background:"url("+THEME_INFO.themedata.trackeven_path+") repeat"},$(".yyycj .paoma .xxx").css(a),$(".yyycj .zd").css(e),$(".yyycj ul li").css(t),$(".yyycj ul li:nth-child(2n)").css(trackeven_css)},resize:function(){this.init();var t=this;this.track_elm.each(function(){$(this).css({height:t.height,"line-height":t.size+"px","font-size":3*t.size/5+"px"}).find(".ma").css({width:1==THEME_INFO.themedata.ishorizontal?"0px":"100%",height:1==THEME_INFO.themedata.ishorizontal?"100%":"0px"}),$(this).find(".tutu").css({width:1==THEME_INFO.themedata.ishorizontal?"0px":"100%",height:1==THEME_INFO.themedata.ishorizontal?"100%":"0px"})})},ph_arr:[],showprogress:function(t,e){null==this.tracklist_elm&&this.resize(),null==this.ph_arr[t]&&(this.ph_arr[t]=$("#ph"+t));var a=this.ph_arr[t],i=$("#nc"+t,a);i.html(e.nickname);var s=$("#symbol"+t,a);s.attr("src",THEME_INFO.themedata["avatar_"+(t+1)+"_path"]);var n=$("#tx"+t,a);t<3&&100<=e.progress?n.attr("src",WEB_URL+"images/shake/p"+t+".jpg"):n.attr("src",e.avatar),1==THEME_INFO.themedata.ishorizontal?(ph_css={"min-width":this.size+"px",width:e.progress+"%","margin-top":"-"+this.size/2+"px"},symbol_css={"max-height":this.size+"px"}):(ph_css={"min-height":this.size+"px",height:e.progress+"%","margin-left":"-"+this.size/2+"px"},symbol_css={"max-width":this.size+"px",left:(this.width-s.width())/2+"px"}),s.css(symbol_css);var o=1==THEME_INFO.themedata.ishorizontal?s.width()+4:s.height()+4,r=o+(1==THEME_INFO.themedata.ishorizontal?n.width()+4:n.height()+4);1==THEME_INFO.themedata.ishorizontal?(n.css({right:o+"px"}),i.css({right:r+"px"})):(n.css({top:o+"px"}),i.css({top:r+"px"})),a.animate(ph_css,1e3),$("#pxh"+t).animate(ph_css,1e3)}},StartPage={qrcode:"",round_welcome_elm:null,radar_timer:null,getplayer_timer:null,showusers:[],userindex:0,init:function(){var t=this;t.qrcode=$(window.top.document).find("#box img").attr("src"),t.qrcode=t.qrcode.replace("./","/"),t.qrcode=t.qrcode.trim(),t.round_welcome_elm=$(".round-welcome"),t.round_welcome_elm.find("img.qr").attr("src",t.qrcode),1==SHAKE_CONFIG.status&&($(".button-restart").hide(),$(".button-round-rank").hide()),2==SHAKE_CONFIG.status&&($(".radar").hide(),$(".round-label2").hide()),3==SHAKE_CONFIG.status&&($(".button-start").hide(),$(".radar").hide(),$(".round-label2").hide()),null==SHAKE_CONFIG.previd&&$(".button-round.round-prev").hide(),null==SHAKE_CONFIG.nextid&&$(".button-round.round-next").hide(),$(".button-round-rank").on("click",function(){EndPage.showScore()}),$("#reset_btn").on("mouseover",function(){$(this).css({opacity:1})}),$("#reset_btn").on("mouseout",function(){$(this).css({opacity:.3})}),$("#reset_btn").on("click",resetgame),$(".button-restart").on("click",function(){resetgame()}),$(".button-round.round-next").on("click",function(){window.location.href="shake.php?id="+SHAKE_CONFIG.nextid}),$(".button-round.round-prev").on("click",function(){window.location.href="shake.php?id="+SHAKE_CONFIG.previd}),$(".button-start").on("click",function(){t.slideUp(),countdown(3,startgame)}),$(".round-label").text("轮次编号："+SHAKE_CONFIG.id),1==SHAKE_CONFIG.status&&(t.getplayers(),t.showuser())},slideDown:function(t){console.log("init startpage1"),""==this.qrcode&&this.init(),$(window.top.document).find("#show_hide_nav img").trigger("click"),this.round_welcome_elm.slideDown(t)},slideUp:function(t){""==this.qrcode&&this.init(),$("#reset_btn").show(),$("#reset_btn").css({opacity:.3}),$(window.top.document).find("#show_hide_nav img").trigger("click"),clearTimeout(this.getplayer_timer),clearTimeout(this.radar_timer),this.round_welcome_elm.slideUp(t)},getplayers:function(){var e=this;$.ajax({url:"ajax_act_shake.php?action=joinuser",type:"get",dataType:"json",success:function(t){$(".round-label2 span").html("<i>"+t.data.num+"</i>").find("i").toggleClass("animate-rotate2"),null!=t.data.players&&0<t.data.players.length&&(e.showusers=e.showusers.concat(t.data.players)),e.getplayer_timer=setTimeout(function(){e.getplayers()},3e3)}})},showuser:function(){var t=this;if(t.showusers.length<=0)t.radar_timer=setTimeout(function(){t.showuser()},1e3);else{t.userindex++;var e=t.showusers.shift();$("#Audio_NewPlayer")[0].play();var a='<div id="shake_user_'+t.userindex+'" class="user-item"><div class="user-img"><img src="'+e.avatar+'" /></div><p></p></div>';9<$(".user-item").length?$(".user-item").eq(0).animate({opacity:0},1e3,function(){$(this).remove(),$(a).appendTo(".users").animate({opacity:.7},500),console.log(2)}):$(a).appendTo(".users").animate({opacity:.7},500),t.radar_timer=setTimeout(function(){t.showuser()},1e3)}}},resizePart=window.WBActivity.resize=function(){1==THEME_INFO.themedata.ishorizontal?($(".tracklist").removeClass("vertical"),$(".tracklist").addClass("horizontal")):($(".tracklist").removeClass("horizontal"),$(".tracklist").addClass("vertical")),console.log("test"),Track.resize()},start=window.WBActivity.start=function(){window.WBActivity.hideLoading(),$(".Panel.Top").css({top:0}),$(".Panel.Bottom").css({bottom:0}),$(".Panel.Track").css({display:"block",opacity:1}),resizePart(),window.setTimeout(function(){nextRound()},1e3)},startcountdown=!1;function countdown(t,e){if(1!=startcountdown){startcountdown=!0;var a=t,i=$(".cutdown-start");i.html(t).show().css({"margin-left":-i.width()/2+"px","margin-top":-i.height()/2+"px","font-size":.7*i.height()+"px","line-height":i.height()+"px"}).addClass("cutdownan-imation");var s=$("#Audio_CutdownPlayer")[0];s.play(),lefthandler=setInterval(function(){a-=1,s.play(),0<a?i.html(a):(i.html("GO!!!"),clearInterval(lefthandler),startcountdown=!1,setTimeout(function(){i.hide(),e()},1e3))},1e3)}}function gameworking(){$.ajax({url:"ajax_act_shake.php?action=working",type:"get",dataType:"json",success:function(t){if(0<t.code){if(SHAKE_CONFIG.status=t.status,1==t.status&&(clearTimeout(workingdata_timer),Slogan.hide(),alert("游戏被重置了，5秒后将刷新页面，重新开始"),setTimeout(function(){window.location.reload()},5e3)),2==t.status){for(var e=0,a=t.data.length;e<a;e++)Track.showprogress(e,t.data[e]);Slogan.show(),workingdata_timer=setTimeout(function(){gameworking()},1e3)}if(3==t.status){TOPTEN=t.data;for(e=0,a=t.data.length;e<a;e++)Track.showprogress(e,t.data[e]);EndPage.show(),Slogan.hide(),clearTimeout(workingdata_timer)}}else alert("数据可能出现错误，5秒后尝试刷新页面，重新开始"),setTimeout(function(){window.location.reload()},5e3)},error:function(){alert("网络可能断了，5秒后尝试重新连接，请刷新重新开始"),setTimeout(function(){window.location.reload()},5e3)}})}function gameresult(i){$.ajax({url:"ajax_act_shake.php?action=result",type:"get",dataType:"json",success:function(t){if(0<t.code){if(3==t.status){TOPTEN=t.data;for(var e=0,a=t.data.length;e<a;e++)Track.showprogress(e,t.data[e])}i()}else alert("数据可能出现错误，5秒后尝试刷新页面，重新开始"),setTimeout(function(){window.location.reload()},5e3)},error:function(){alert("网络可能断了，5秒后尝试重新连接，请刷新重新开始"),setTimeout(function(){window.location.reload()},5e3)}})}var workingdata_timer=null;function startgame(){$.ajax({url:"ajax_act_shake.php?action=start",type:"get",dataType:"json",success:function(t){0<t.code?gameworking():(alert(t.message),window.location.reload())},error:function(){alert("网络可能断了，5秒后尝试重新连接，请刷新重新开始"),setTimeout(function(){window.location.reload()},5e3)}})}function resetgame(){$.ajax({url:"ajax_act_shake.php?action=reset",type:"get",dataType:"json",success:function(t){alert("重置成功，3秒后重新自动刷新页面"),setTimeout(function(){window.location.reload()},3e3)},error:function(){alert("网络可能断了，5秒后尝试重新连接，请刷新重新开始"),setTimeout(function(){window.location.reload()},5e3)}})}var nextRound=function(){$(".result-layer").hide(),null==SHAKE_CONFIG.id&&(alert("游戏不存在。"),window.location.href="/wall/index.php"),1==SHAKE_CONFIG.status&&StartPage.slideDown(),2==SHAKE_CONFIG.status&&StartPage.slideUp(function(){startgame()}),3==SHAKE_CONFIG.status&&StartPage.slideDown()},EndPage={result_layer:null,result_label:null,result_cap:null,player_tp:$("<div class='player'><div class='head'></div><div class='nickname'></div></div>"),showGameoverPage:function(){this.result_layer.show(),this.result_label.show().addClass("pulse"),this.result_cup.hide(),$("#Audio_Gameover")[0].play()},bindButtons:function(){var t=this,e=$(".allresult",this.result_layer),a=$(".prevround",this.result_layer),i=$(".nexttound",this.result_layer),s=$(".reset",this.result_layer);null==SHAKE_CONFIG.previd?a.hide():a.on("click",function(){window.location.href="shake.php?id="+SHAKE_CONFIG.previd}),null==SHAKE_CONFIG.nextid?i.hide():i.on("click",function(){window.location.href="shake.php?id="+SHAKE_CONFIG.nextid}),e.on("click",function(){t.showScore()}),s.on("click",function(){resetgame()})},show:function(){var e=this;function t(){e.bindButtons(),window.setTimeout(function(){e.result_label.fadeOut(function(){e.result_cup.show(function(){1<=winner_num&&TOPTEN[0]&&window.setTimeout(function(){var t=e.player_tp.clone().addClass("result").css({left:"50%","margin-left":"-65px",width:"160px",height:"160px",bottom:"150px"});t.find(".head").css({"background-image":"url("+TOPTEN[0].avatar+")"}).addClass("shake"),t.find(".nickname").html(TOPTEN[0].nickname),t.appendTo(e.result_cup).addClass("bounce"),console.log("1")},800),2<=winner_num&&TOPTEN[1]&&window.setTimeout(function(){var t=e.player_tp.clone().addClass("result").css({left:"40px",width:"100px",height:"100px",bottom:"120px"});t.find(".head").css({"background-image":"url("+TOPTEN[1].avatar+")"}).addClass("shake"),t.find(".nickname").html(TOPTEN[1].nickname),t.appendTo(e.result_cup).addClass("bounce"),console.log("2")},1800),3<=winner_num&&TOPTEN[2]&&window.setTimeout(function(){var t=e.player_tp.clone().addClass("result").css({right:"30px",width:"70px",height:"70px",bottom:"100px"});t.find(".head").css({"background-image":"url("+TOPTEN[2].avatar+")"}).addClass("shake"),t.find(".nickname").html(TOPTEN[2].nickname),t.appendTo(e.result_cup).addClass("bounce"),console.log("3")},2800)})}).removeClass("pulse")},1e3)}this.result_layer=$(".result-layer"),this.result_label=$(".result-label",this.result_layer),this.result_cup=$(".result-cup",this.result_layer),winner_num=3,this.showGameoverPage(),null==TOPTEN?gameresult(t):t()},showScore:function(){var t=PATH_ACTIVITY+Path_url("shake_result.php");$.showPage(t)}},Slogan={slogan_timer:null,show:function(){var t=$.isArray(THEME_INFO.themedata.tips)&&0<THEME_INFO.themedata.tips.length?THEME_INFO.themedata.tips:["再大力！","再大力,再大力！","再大力,再大力,再大力！","摇，大力摇","快点摇啊，别停！","摇啊，摇啊，摇啊","小心手机，别飞出去伤到花花草草","看灰机～～～"],e=t.length,a=$(".Panel.SloganList");a.css({top:"-15%"}).show(),a.css({top:0,"line-height":a.height()+"px"}),null==this.slogan_timer&&(this.slogan_timer=setInterval(function(){a.html(t[Math.floor(Math.random()*e)])},2e3))},hide:function(){clearInterval(this.slogan_timer),$(".Panel.SloganList").hide()}};$(function(){if(""!=THEME_INFO.themedata.bg_path){var t=THEME_INFO.themedata.bg_path.lastIndexOf(".");".mp4"==THEME_INFO.themedata.bg_path.substr(t)?($(window.top.document).find("iframe").css({"background-image":""}),$(window.top.document).find(".bgvideo video").attr("src",THEME_INFO.themedata.bg_path)):($(window.top.document).find(".bgvideo video").attr("src",""),$(window.top.document).find("iframe").css({"background-image":"url("+THEME_INFO.themedata.bg_path+")"}))}else{var e=window.top.BACKGROUNDIMAGE.shake;2==e.bgtype?($(window.top.document).find("iframe").css({"background-image":""}),$(window.top.document).find(".bgvideo video").attr("src",e.path)):($(window.top.document).find(".bgvideo video").attr("src",""),$(window.top.document).find("iframe").css({"background-image":"url("+e.path+")"}))}});