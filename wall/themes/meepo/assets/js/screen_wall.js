!function(o,m){function h(t,s,i,n,e,a){t.attr("msg_id",e),t.find(".u-head img").attr("src",s),t.find(".u-nickname").html(i);var c=t.find(".u-head").height();MsgList.resizeHead(c,Math.floor(c/3),t),2==a&&(n="<div class='msg-pic'><img src = "+n+" width=auto height = "+(t.find(".u-msgword").height()-5)+"px  /></div>");MsgList.remapContent(c,t),t.find(".u-msgword").html(n).toFillText();var o=parseInt(t.find(".u-msgword").css("font-size"));t.find(".u-msgword > img").css({width:o+"px",height:o+"px"})}var g,l=0;var r=0;function i(){var t;if(0<n.length?(t=n.pop(),a.push(t)):0<a.length&&1==u&&(t=function t(){var s=a.length,i=Math.floor(Math.random()*s),n=a[i],e=m(".MsgItem[msg_id="+n.shenhetime+"]",".Panel.MsgList");return e.length<=1?n:t()}()),t&&("0"==c?function(t,s,i,n,e,a){if(!getMsgItemById(n)){var c;g=d.children(),r<=f?((c=m(g[r])).fadeIn(),h(c,t,s,i,n,e)):(c=m(g[0])).fadeOut(function(){m(g[2]).css({"margin-bottom":c.css("margin-bottom")}),c.css({"margin-bottom":c.css("margin-bottom"),visibility:"hidden",display:"block"}),h(c,t,s,i,n,e),c.slideUp(function(){c.remove().css({visibility:"visible",display:"none"}).appendTo(d).fadeIn()})}),r++,$.isFunction(a)&&a.call(this)}}(t.avatar,t.nick_name,t.content,t.shenhetime,t.type):function(t,s,i,n,e,a){if(!getMsgItemById(n)){var c=m(g[l]);c.fadeOut(function(){c.css({visibility:"hidden",display:"block"}),h(c,t,s,i,n,e),c.css({visibility:"visible"}),c.addClass("msgin"),o.setTimeout(function(){c.removeClass("msgin")},2e3),f<++l&&(l=0)}),$.isFunction(a)&&a.call(this)}}(t.avatar,t.nick_name,t.content,t.shenhetime,t.type),2==t.type&&1==_)){clearInterval(show_msg_2);var s='<span class="close-btn">&Chi;</span><div class="header"><img src="'+t.avatar+'" alt="" class="head-img"><span class="nickname">'+t.nick_name+'</span></div><div class="content"><img class="content-img" src="'+t.content+'" alt="图片"></div>';$(".MsgList").fadeOut(function(){$(".msg-box").html(s).fadeIn()}),setTimeout(function(){$(".msg-box").fadeOut(function(){$(".MsgList").fadeIn()}),show_msg_2=setInterval(function(){i()},e)},p)}}var d,f,s=0;function t(t){m.getJSON(PATH_ACTIVITY+Path_url("ajax_act_new_msg.php"),{shenhetime:s},function(t){t&&0==t.ret&&m.isArray(t.data)&&0<t.data.length&&(n=t.data.concat(n),s=t.data[0].shenhetime)}).complete(function(){t&&"function"==typeof t&&t.call()})}var n=[],a=[],e=1e3*WALL_INFO.re_time,c=WALL_INFO.show_style,u=WALL_INFO.show_type,_=WALL_INFO.show_big,p=1e3*WALL_INFO.show_big_time;WALL_INFO.chistory&&WALL_INFO.chistory;d=m(".Panel.MsgList"),f=d.children().length-1,g=d.children(),t(function(){m(".Panel.Top").css({top:0}),m(".Panel.Bottom").css({bottom:0}),m(".Panel.MsgList").css({display:"block",opacity:1}),g.hide(),show_msg_2=setInterval(function(){i()},e),check_msg=setInterval(function(){t()},e)}),$(document).on("click",".close-btn",function(t){$(".msg-box").fadeOut(function(){$(".MsgList").fadeIn("normal")}),show_msg_2=setInterval(function(){i()},e)}).on("click",".MsgItem",function(){var t=$(this).find(".u-nickname").html(),s=$(this).find(".u-head img").attr("src"),i=$(this).find(".u-msgword").html();if(0<$(this).find(".msg-pic").length)var n='<span class="close-btn">&Chi;</span><div class="header"><img src="'+s+'" alt="" class="head-img"><span class="nickname">'+t+'</span></div><div class="content"><img class="content-img" src="'+$(this).find(".msg-pic").children().attr("src")+'" alt="图片"></div>';else n='<span class="close-btn">&Chi;</span><div class="header"><img src="'+s+'" alt="" class="head-img"><span class="nickname">'+t+'</span></div><div class="content"><p>'+i+"</p></div>";$(".MsgList").fadeOut(function(){$(".msg-box").html(n).fadeIn("normal");var t=$(".msg-box .content").height()/6;$(".msg-box .content p").css({"font-size":t+"px"})}),clearInterval(show_msg_2)})}(window,jQuery),$(function(){MsgList.resize(),$(window).on("resize",function(){MsgList.resize()})});var MsgList={_msglist:null,_msgitems:null,_msgitem_height:0,_calc_msgitem_height:function(){var t=this._msglist.height();this._msgitem_height=Math.floor((t-5*(MSG_NUM-1))/MSG_NUM)},resize:function(){this._msglist=null==this._msglist?$(".MsgList"):this._msglist,this._msgitems=null==this._msgitems?$(".MsgItem"):this._msgitems,this._calc_msgitem_height(),this.resizeMsg()},resizeMsg:function(){this._msgitems.css({height:this._msgitem_height+"px"}),msgitemspadding=20;for(var t=0,s=this._msgitems.length;t<s;t++){var i=this._msgitem_height-msgitemspadding;$(this._msgitems[t]).find(".u-head").css({height:i+"px"}),this.resizeHead(i,Math.floor(i/3),$(this._msgitems[t])),this.remapContent(i,$(this._msgitems[t]))}},remapContent:function(t,s){var i=t+10,n=s.width()-i-10;$(s).find(".msg-contain").css({left:i+"px",width:n+"px"})},resizeContent:function(t,s,i){},resizeHead:function(t,s,i){$(i).find(".nickname-bg").css({height:s+"px",width:t+"px"});var n=$(i).find(".nickname-bg").find(".u-nickname").text(),e=(n=delHtmlTag(n)).length;e=e<=0?1:e,fontsize=Math.floor((t-4)/e)/1.7,fontsize=fontsize>s?s-2:fontsize,$(i).find(".nickname-bg").find(".u-nickname").css({"font-size":fontsize+"px"})}};function showthis(t){var s=getMsgItemById(t),i=$(s).find(".u-head").eq(0),n=$(i).find("img").attr("src"),e=$(s).find(".u-nickname").eq(0);e=$(e).text();var a=$(s).find(".u-msgword").find("img").attr("src");$("#hdimg").attr("src",n),$("#zsmc").html(e),$(".jbmz").html("大图"),$(".jbshow").addClass("view"),$(".jbleft").css({background:"url("+a+") no-repeat center center","background-size":"auto 100%"}),$(".jbshow").addClass("view")}function getMsgItemById(t){for(var s=$(".MsgItem"),i=0,n=s.length;i<n;i++)if($(s[i]).attr("msg_id")==t)return s[i];return!1}function closeit(){$(".jbshow").removeClass("view")}function delHtmlTag(t){return t.replace(/<[^>]+>/g,"")}