var shuqian_data_time,tmr_cutdown_start,game_cutdown_start,game_check_join,resizePart=window.WBActivity.resize=function(){$(".shuqian_btn_groups").css({top:($(window).height()-$(".shuqian_btn_groups").height())/2+20,left:($(window).width()-$(".shuqian_btn_groups").width())/2,display:"block"})},start=window.WBActivity.start=function(){if(window.WBActivity.hideLoading(),$(".Panel.Top").css({top:0}),$(".Panel.Bottom").css({bottom:0}),$(".shu-money,.new_join_user").css({display:"block"}),1==shuqian_config.status?$(".g-game-btn").css({display:"block"}):$(".g-game-btn-restart,.g-game-btn-paiming").show(),shuqian_config.nextid&&$(".g-game-btn-next").show(),shuqian_config.previd&&$(".g-game-btn-prev").show(),$("#reset_btn").on("mouseover",function(){$(this).css({opacity:1})}),$("#reset_btn").on("mouseout",function(){$(this).css({opacity:.3})}),$("#reset_btn").on("click",function(){confirm("重玩本轮会导致本轮成绩作废并清空，您确定吗？")&&t()}),resizePart(),"0"==rotate_id)return $(".shu-money,.btn-endgame,.new_join_user,.enlarge-qrcode").hide(),showScore(),void $(".frame-dialog .closebutton").hide();function t(){$.getJSON("ajax_act_shuqian.php?action=shuqian_reset",{},function(t){0<t.code||layer.msg("重置失败啦"),window.location.reload()})}function n(t){$.getJSON("ajax_act_shuqian.php?action=changeconfig",{id:t},function(t){0<t.code?window.setTimeout(function(){window.location.reload()},500):layer.msg("没有更多的轮次了!")})}$(".enlarge-qrcode").css({visibility:"visible"}),$(".enlarge-qrcode div").addClass("animated rollIn"),game_check_join=window.setInterval(function(){$.ajax({type:"post",url:"ajax_act_shuqian.php?action=shuqian_joinuser",dataType:"json",success:function(t){$(".new_join_user span").html("<i>"+t.message+"</i>").find("i").toggleClass("animate-rotate2")}})},2e3),$(".qr_close").on("click",function(){$(".enlarge-qrcode div").attr("class","animated rollOut"),setTimeout(function(){$(".enlarge-qrcode").hide()},1e3)}),$(".g-game-btn").on("click",function(){$(this).hide(),$(".g-game-btn-prev,.g-game-btn-next,.g-game-btn-restart,.g-game-btn-paiming").hide(),window.clearInterval(game_check_join),$(".new_join_user,.enlarge-qrcode").hide(),$(".shu-num-box").html(ready_time),$(".shu-start-tooltip-box").show(),cutdown_start()}),$(".g-game-btn-restart").on("click",function(){confirm("重玩本轮会导致本轮成绩作废并清空，您确定吗？")&&t()}),$(".btn-endgame").on("click",function(){confirm("确定强制结束本轮游戏么？")&&$.getJSON("ajax_act_shuqian.php?action=shuqian_stop",{},function(t){0<t.code?(window.clearInterval(tmr_cutdown_start),window.clearInterval(shuqian_data_time)):layer.msg("操作失败、请重试!"),window.location.reload()})}),$(".g-game-btn-paiming").on("click",function(){$(".shu-money").hide(),showScore(rotate_id)}),$(".g-game-btn-next").on("click",function(){n(shuqian_config.nextid)}),$(".g-game-btn-prev").on("click",function(){n(shuqian_config.previd)}),$(".game-winner-close").on("click",function(){$(".game-winner").hide(),show_game_start()})};function showScore(t){a="/wall/shuqian_result.php",$.showPage(a)}var show_game_start=function(){resizePart(),$(".shu-title").show()},cutdown_start=function(){var n=$(".shu-start-tooltip-box"),e=($(".cutdown-start"),$(".shu-title"));tmr_cutdown_start=window.setInterval(function(){ready_time--,0==ready_time?($("#reset_btn").show(),$("#reset_btn").css({opacity:.3}),$.getJSON("/wall/ajax_act_shuqian.php?action=shuqian_start",{},function(t){0<t.code?n.find(".shu-num-box").html("GO"):(-2==t.code?(e.hide(),layer.msg("当前轮数无人参与、无法开始!")):layer.msg("游戏初始参数错误，请刷新重新开始"),setTimeout(function(){window.location.reload()},3e3))}).fail(function(){layer.msg("无法连接游戏服务器，请刷新重新开始"),setTimeout(function(){window.location.reload()},3e3)})):0<ready_time?($("#Audio_CutdownPlayer")[0].play(),n.find(".shu-num-box").html(ready_time)):(e.hide(),n.hide(),window.clearInterval(tmr_cutdown_start),window.shuqian_data_time=setInterval(function(){$.ajax({url:"/wall/ajax_act_shuqian.php?action=working",type:"get",dataType:"json",success:function(t){0<t.code&&show_gameuser(t.data)}})},1e3),game_start())},1e3)},game_start=function(){var t=$(".cutdown-start");t.html(""),t.css({"margin-left":-t.width()/2+"px","margin-top":-t.height()/2+"px","font-size":.7*t.height()+"px","line-height":t.height()+"px"}),t.show(),$(".btn-endgame").show(),game_cutdown_start=window.setInterval(function(){game_time--,0==game_time?t.html(game_time):game_time<0?(t.hide(),window.clearInterval(game_cutdown_start),$.ajax({url:"/wall/ajax_act_shuqian.php?action=shuqian_stop",type:"post",dataType:"json",success:function(t){window.clearInterval(shuqian_data_time),0==game_end&&(game_end=1,$("#Audio_Gameover")[0].play(),$("body").mLoading({text:"正在保存数据、请稍后...",icon:"themes/meepo/assets/template/resource/images/loading2.gif"}),$.ajax({url:"/wall/ajax_act_shuqian.php?action=end",type:"get",dataType:"json",success:function(t){$("body").mLoading("hide"),0<t.code?(console.log(d),window.setTimeout(function(){show_gameresult(t.data),shuqian_config.previd&&$(".g-game-btn-prev").show(),shuqian_config.nextid&&$(".g-game-btn-next").show(),$(".g-game-btn-restart,.g-game-btn-paiming").show(),$(".btn-endgame").hide()},660)):layer.msg("数据存贮失败!")}}))}})):t.html(game_time)},1e3)},show_gameuser=function(h){h=(h=transform(h)).sort(function(t,n){return n.score-t.score}),total_user=h,$.isArray(h)&&(rankTopTen=h.slice(0,10),$(".shu-rank-item").each(function(t){var n,e=h[t],a=" ",i=0;e&&(a=e.client_name,i=parseInt(100*e.score),n=e.client_avatar);var o=$(this),s=o.find(".shu-rank-item-score");if(!parseInt(s.text()>i)){if(0<i){var r=Math.floor(i/25e3*400);r=400<r?400:r,o.find(".shu-rank-item-body").css("height",r)}else o.find(".shu-rank-item-body").css("height",0);o.find(".shu-rank-item-name").html(a),s.text(i);var c=o.find(".shu-rank-item-info > img");n?(c.css("visibility","visible"),c.attr("src",n)):c.css("visibility","hidden")}}))},show_gameresult=function(r){$.isArray(r)&&($(".game-winner-item").each(function(t){var n,e=r[t],a=" ",i=0;if(e){a=e.client_name,i=parseInt(100*e.score),n=e.client_avatar;var o=$(this);o.find(".gn-item-number").text("￥"+i),o.find(".gn-item-name").html(a);var s=o.find(".gn-item-head > img");s.attr("src",n),s.css({display:"block"})}}),3<r.length&&$(".game_winner_other_box").each(function(t){var n,e=r[t+3],a=" ",i=0;if(e){a=e.client_name,i=parseInt(100*e.score),n=e.client_avatar;var o=$(this);o.find(".winner_head_boxscore").text("￥"+i),o.find(".winner_head_box-name").html(a),o.find(".winner_head_box > img").attr("src",n)}}));$(".game-winner").show()};function transform(t){var n=[];for(var e in t)"meepo_xinchang_shuqian"!=t[e].client_openid&&n.push(t[e]);return n}function hideSlogan(){$(".Panel.Top").css({top:"-"+$(".Panel.Top").height()+"px"}),$(".Panel.Bottom").css({bottom:"-"+$(".Panel.Bottom").height()+"px"}),$("#panel_status").val("0")}function showSlogan(){$(".Panel.Top").css({top:0}),$(".Panel.Bottom").css({bottom:0}),$("#panel_status").val("1")}