var camera,scene,renderer,controls,runninganimate,oss=[],targets=null,style="table",animate_start=0;function init(e){oss=[],targets={table:[],sphere:[],grid:[]},(camera=new THREE.PerspectiveCamera(40,window.innerWidth/window.innerHeight,1,1e5)).position.z=2800,scene=new THREE.Scene;for(var n=0;n<e.length;n++){var t=document.createElement("div");t.className="element";var i=document.createElement("img");i.src=e[n].avatar,t.appendChild(i),(d=new THREE.CSS3DObject(t)).position.x=4e3*Math.random()-2e3,d.position.y=4e3*Math.random()-2e3,d.position.z=4e3*Math.random()-2e3,scene.add(d),oss.push(d)}for(var o=new THREE.Vector3,r=(n=0,e.length);n<r;n++){if(0==n)var a=1.025*Math.acos(2*n/r-1),s=Math.sqrt(r*Math.PI)*a*1.01;else a=Math.acos(2*n/r-1),s=Math.sqrt(r*Math.PI)*a;(d=new THREE.Object3D).position.x=750*Math.cos(s)*Math.sin(a),d.position.y=750*Math.sin(s)*Math.sin(a),d.position.z=750*Math.cos(a),o.copy(d.position).multiplyScalar(2),d.lookAt(o),targets.sphere.push(d)}for(o=new THREE.Vector3,n=0,r=e.length;n<r;n++){var d;(d=new THREE.Object3D).position.x=n%5*600-1200,d.position.y=-Math.floor(n/5)%5*400+800,d.position.z=200-60*n*1.5,d.rotation.z=.03*-n,o.x=d.position.x,o.y=d.position.y,o.z=d.position.z,d.lookAt(o),targets.grid.push(d)}(renderer=new THREE.CSS3DRenderer).setSize(window.innerWidth,window.innerHeight),renderer.domElement.style.position="absolute",renderer.domElement.className="lottery_renderer",document.getElementById("lottery_main").appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1)}function transform(e,n,t,i){TWEEN.removeAll(),scene_init();for(var o=animate_start=0;o<oss.length;o++){var r=oss[o],a=e[o];new TWEEN.Tween(r.position).to({x:a.position.x,y:a.position.y,z:a.position.z},n).easing(TWEEN.Easing.Exponential.InOut).start(),"grid"==t&&new TWEEN.Tween(r.position).to({x:a.position.x,y:a.position.y,z:a.position.z},1e3).delay(195e3).start(),new TWEEN.Tween(r.rotation).to({x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},Math.random()*n+n).easing(TWEEN.Easing.Exponential.InOut).start()}new TWEEN.Tween(this).to({},1e6).onUpdate(function(){render(t)}).start()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),render()}function animate(){runninganimate=window.requestAnimationFrame(animate),TWEEN.update(),render()}function resetanimate(){window.cancelAnimationFrame(runninganimate)}function scene_init(){scene.position.x=0,scene.position.y=0,scene.position.z=0,scene.rotation.x=0,scene.rotation.y=0,scene.rotation.z=0}function update2(){for(var e=0;e<oss.length;e++){var n=oss[e];n.position.z+=180,800<n.position.z&&(n.position.z=200-60*(oss.length-1)*1.5)}}function render(e){"grid"==e&&update2(),"sphere"==e&&((animate_start+=1)%1200<600?scene.rotation.y+=.1:scene.rotation.x+=.1);renderer.render(scene,camera)}function restartanimate(){TWEEN.removeAll(),resetanimate(),$(".lottery_renderer").remove()}function startanimate(e,n){init(e),"sphere"==n?transform(targets.sphere,50,"sphere"):transform(targets.grid,50,"grid"),animate()}