var metapc=function(){var e=window;var g={};var h=e.document;var b=h.documentElement;var j=e.devicePixelRatio;var i=1;var c=1;function k(){var m=/iphone/gi.test(e.navigator.appVersion);i=1;e.devicePixelRatioValue=i;c=1/i;var p=h.querySelector('meta[name="viewport"]');if(p){if(m){p.setAttribute("content","width=device-width, initial-scale="+c+", user-scalable=no")}else{p.setAttribute("content","width=device-width, initial-scale="+c+", maximum-scale="+c+", minimum-scale="+c+", user-scalable=no")}}else{var n=h.createElement("meta");n.setAttribute("name","viewport");if(m){n.setAttribute("content","width=device-width, initial-scale="+c+", user-scalable=no")}else{n.setAttribute("content","width=device-width, initial-scale="+c+", maximum-scale="+c+", minimum-scale="+c+", user-scalable=no")}if(b.firstElementChild){b.firstElementChild.appendChild(n)}else{var o=h.createElement("div");o.appendChild(n);h.write(o.innerHTML)}}}k();var f=100;g.errDpr=1;function a(){var m;if(g.maxWidth){m=Math.min(b.getBoundingClientRect().width,g.maxWidth*i)}else{m=b.getBoundingClientRect().width}f=100*m/g.desinWidth*(g.errDpr||1);b.style.fontSize=f+"px";h.body&&(h.body.style.fontSize=g.baseFont/100+"rem");g.setRemCallback&&g.setRemCallback();g.newBase=f}var d;g.desinWidth=4096;g.baseFont=24;g.reflow=function(){b.clientWidth};function l(){if(/android/ig.test(window.navigator.appVersion)){var o=document.createElement("p");o.style.height="1px";o.style.width="2.5rem";o.style.visibility="hidden";document.body.appendChild(o);var m=o.offsetWidth;var n=g.newBase*2.5;if(Math.abs(n/m-1)>0.05){g.errDpr=n/m;a()}document.body.removeChild(o)}a()}g.init=function(){$(document).ready(function(){clearTimeout(d);d=setTimeout(a,300)});$(document).on("resize",function(){clearTimeout(d);d=setTimeout(a,300)});e.addEventListener("pageshow",function(m){if(m.persisted){clearTimeout(d);d=setTimeout(a,300)}},false);if(h.readyState==="complete"){h.body.style.fontSize=g.baseFont/100+"rem";l()}else{h.addEventListener("DOMContentLoaded",function(m){h.body.style.fontSize=g.baseFont/100+"rem";l()},false)}b.setAttribute("data-dpr",i)};g.remToPx=function(m){return m*f};g.repairBug=a;return{"init":function(n,m,o){g.desinWidth=n;g.baseFont=m;g.maxWidth=o;g.init()}}};function shuffle(b){var a=b.length;for(var e=0;e<a-1;e++){var d=parseInt(Math.random()*(a-e));var c=b[d];b[d]=b[a-e-1];b[a-e-1]=c}return b}var new3d=function(){var p=120;var l=120;var r=null;var k=null;var d=null;var a=null;function b(){if(a==null){a=new Stats();a.domElement.style.position="absolute";a.domElement.style.top="0px";container.appendChild(a.domElement)}else{a.update()}}function n(u){objname="prize";if(r==null){r=new THREE.Scene();var z=new THREE.BoxGeometry(1,1,1);var w=new THREE.TextureLoader().load(u);var v=new THREE.MeshStandardMaterial({color:16777215,map:w});var s=new THREE.Mesh(z,v);s.name=objname;r.add(s);var t=new THREE.AmbientLight(4210752,7);t.position.set(0,0,100);r.add(t);var y=new THREE.PointLight(4210752,5,100);y.position.set(0,0,50);r.add(y)}else{var x=r.getObjectByName(objname);r.remove(x);var z=new THREE.BoxGeometry(1,1,1);var w=new THREE.TextureLoader().load(u);var v=new THREE.MeshStandardMaterial({color:16777215,map:w});var s=new THREE.Mesh(z,v);s.name="prize";r.add(s)}}function f(t,s){if(k==null){k=new THREE.WebGLRenderer({alpha:true});k.setSize(t,s);$(k.domElement).appendTo("#prize")}}var q=new THREE.PerspectiveCamera(40,p/l,0.1,100);q.position.z=3;var m=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,0.1);m.position.z=450;m.position.y=400;var o=false;function c(t){console.log("playerscene");var u=210;var F=t.length;var v=new THREE.Vector3();var H=0;var s=[];if(d==null){d=new THREE.Scene();for(var C=0;C<u;C++){var G=t[C%F];var B=document.createElement("div");B.className="element";var A=document.createElement("img");A.src=G.avatar;B.appendChild(A);$(B).hide();$(A).one("load",function(){var I=$(this).parent();I.animateControl("fadeIn slower").show()}).one("error",function(){$(this).attr("src","/Modules/Lottery/templates/front/new3d/assets/images/avatar-primary.png")});s.push(B)}s=shuffle(s);for(var C=0,w=s.length;C<w;C++){var E=C*(Math.PI/15);var z=500;var x=new THREE.CSS3DObject(s[C]);x.name="player"+C;x.position.x=z*Math.sin(E);if(C%30===0){H++}x.position.y=H*100;x.position.z=z*Math.cos(E);v.x=x.position.x*2;v.y=x.position.y;v.z=x.position.z*2;x.lookAt(v);d.add(x)}}else{var D=d.children;for(var C=0,w=D.length;C<w;C++){var y=d.getObjectByName("player"+C);d.remove(y)}for(var C=0;C<u;C++){var G=t[C%F];var B=document.createElement("div");B.className="element";var A=document.createElement("img");A.src=G.avatar;B.appendChild(A);$(B).hide();$(A).one("load",function(){console.log("test");A.src=G.avatar;var I=$(this).parent();I.animateControl("fadeIn").show()}).one("error",function(){$(this).attr("src","/Modules/Lottery/templates/front/new3d/assets/images/avatar-primary.png")});s.push(B)}s=shuffle(s);for(var C=0,w=s.length;C<w;C++){var E=C*(Math.PI/15);var z=500;var x=new THREE.CSS3DObject(s[C]);
x.name="player"+C;x.position.x=z*Math.sin(E);if(C%30===0){H++}x.position.y=H*100;x.position.z=z*Math.cos(E);v.x=x.position.x*2;v.y=x.position.y;v.z=x.position.z*2;x.lookAt(v);d.add(x)}}}var i=new THREE.CSS3DRenderer();i.setSize(window.innerWidth,window.innerHeight);$(i.domElement).appendTo("#players");var h=null;var e=function(){h=requestAnimationFrame(e);r.rotation.x+=g;r.rotation.y-=g;d.rotation.y+=j;k.render(r,q);i.render(d,m)};var g=0.005;var j=-0.001;return{"stop":function(){j=-0.001},"start":function(){j=-0.04},"init":function(){if(h==null){e()}},"setPrizeImg":function(s){p=$("#prize").width();l=$("#prize").height();n(s);f(p,l)},"setPlayers":function(s){c(s)}}};var statesessionname="new3d";var prizeindexsessionname="new3d_prize";var index=function(){var H=$(".main_menu").find(".btn_left");var L=$(".main_menu").find(".btn_right");var j=$(".main_menu").find(".btn_reduce");var D=$(".main_menu").find(".btn_add");var p=$(".main_menu").find(".tz-1");var v=0;var g=0;var o=null;var i=prizesdata.length;var b=0;var O=0;var B=lotteryconfig.themeconfig;var m=new3d();function A(){if(prizesdata.length<=0){alert("请先在后台添加奖项,然后刷新页面哦!");return}for(var R=0,Q=prizesdata.length;R<Q;R++){prizesdata[R].totalleft=parseInt(prizesdata[R].leftnum)+parseInt(prizesdata[R].freezenum)}v=parseInt(p.val());M(g)}function M(Q){window.sessionStorage[prizeindexsessionname]=Q;o=prizesdata[Q];var R=o.formatedtext.text;if(R.indexOf("https")!=-1){R="/imageproxy.php?id="+o.prizedata_arr.imageid}m.setPrizeImg(R);$(".top_jp .jpmc").text(o.prizename);$(".words_jx").text(o.prizename);k(o.id);r(function(S){m.setPlayers(S);m.init()});z()}function k(Q){$("#lotterywinners ul").html("");K(Q).done(function(T){if(T.code<0){alert(T.message);return false}else{O=T.data.participants;b=0;if(T.data.winners.length>0){var S="";b=T.data.winners.length;for(var R=0;R<b;R++){S+=f(T.data.winners[R])}$(S).appendTo($("#lotterywinners ul"));$(".main_tb li span").css({"color":B.winnerfontcolor})}$(".hjrs_qty").text(b)}})}function I(R){b++;var Q=f(R);$(Q).prependTo($("#lotterywinners ul"));$(".main_tb li span").css({"color":B.winnerfontcolor});$(".hjrs_qty").text(b)}function f(S){var Q='<li><div class="ircle_rotate"></div><div class="ur_at" style="background-image:url({{image}});"></div><span  class="nickname">{{col1}}</span></li>';var R=Q;if(S["nick_name"]!=""){R=R.replace("{{col1}}",""+S["nick_name"]+"")}else{R=R.replace("{{col1}}","")}if(S["avatar"]!=undefined&&S["avatar"]!=""){R=R.replace("{{image}}",S["avatar"])}else{R=R.replace("{{image}}","/Modules/Lottery/templates/front/new3d/assets/images/avatar-primary.png")}return R}function E(){g=(g+1)%i;d();M(g)}function x(){g=g-1<0?(i-1):(g-1);g=g%i;d();M(g)}function d(){v=1;p.val(v)}function l(){v++;p.val(v)}function y(){v--;v=v<1?1:v;p.val(v)}var h=1;function u(){if(O-v<0){alert("已经没有可以参与抽奖的人了。");return false}if(o.totalleft-v<0){alert("奖品数量不够了，无法进行抽奖。");return false}if(h!=1){return false}h=2;$(".main_mask").animateControl("fadeOut",function(){$(".main_mask").removeClass("animated");$(".main_mask").removeClass("fadeOut");$(".main_mask").hide()});$("#winnerlist").animateControl("fadeOutRight",function(){$("#winnerlist").hide();q()});m.start()}function r(Q){N().done(function(R){if(R.code>0){Q(R.data)}})}var C=[];function s(){if(O-v<0){alert("已经没有可以参与抽奖的人了。");return false}if(o.totalleft-v<0){alert("奖品数量不够了，无法进行抽奖。");return false}if(h!=2){return false}h=3;$(".main_mask").show();a().done(function(Q){if(Q.code>0){m.stop();C=C.concat(Q.data);o.totalleft=o.totalleft-Q.data.length;P();z()}else{alert(Q.message);window.location.reload()}})}function P(){c(C);C=[]}function c(V){$(".currentwinnerlist").hide();var T=$(".currentwinnerlist").find("ul");T.html("");var S="";var U=V.length;U=U>5?5:U;for(var R=0,Q=U;R<Q;R++){S=e(V[R])+S;I(V[R])}$(S).prependTo(T);V.splice(0,U);$(".currentwinnerlist").show();$(".currentwinnerlist").animateControl("zoomInDown",function(){if(V.length<=0){setTimeout(function(){$(".currentwinnerlist").animateControl("fadeOut").hide();$(".winnerlist").show().animateControl("zoomIn");h=1},3000)}else{setTimeout(function(){$(".currentwinnerlist").animateControl("fadeOut").hide();c(V)},3000)}})}function e(S){var Q='<li><div class="ur_at" style="background-image:url({{image}});"></div><span class="nickname">{{col1}}</span><div class="wave solid warning"><div class="circle"></div></div><div class="wave2 solid2 warning2"><div class="circle2"></div></div></li>';var R=Q;if(S["nick_name"]!=""){R=R.replace("{{col1}}",""+S["nick_name"]+"")}else{R=R.replace("{{col1}}","")}if(S["avatar"]!=undefined&&S["avatar"]!=""){R=R.replace("{{image}}",S["avatar"])}else{R=R.replace("{{image}}","/Modules/Lottery/templates/front/new3d/assets/images/avatar-primary.png")}return R}function a(){return $.ajax({"url":"/Modules/module.php?m=lottery&c=front&a=ajaxGetLotteryResult","data":{"activityid":configid,"prizeid":o.id,"num":v},"type":"post","dataType":"json"})}function K(Q){return $.ajax({"url":"/Modules/module.php?m=lottery&c=front&a=ajaxGetWinners","data":{"activityid":configid,"prizeid":Q},"type":"post","dataType":"json"})
}function N(){return $.ajax({"url":"/Modules/module.php?m=lottery&c=front&a=ajaxGetTempUsers&num=70","type":"get","dataType":"json"})}function G(){window.sessionStorage["bgpath"]=B.bg_path;window.sessionStorage["bgmusic"]=B.bgmusic_path+"|"+B.bgmusic_switch;if(lotteryconfigs.length>1){var U=[];var T=["","icon3dcj","iconzjd","iconcjx","icon3Dnewcj"];for(var S=0,Q=lotteryconfigs.length;S<Q;S++){var R=configid==lotteryconfigs[S]["id"]?1:2;U[S]={"name":lotteryconfigs[S]["title"],"action":"/Modules/module.php?m=lottery&c=front&a=index&id="+lotteryconfigs[S]["id"],"icon":T[lotteryconfigs[S]["themeid"]],"current":R}}window.top.roundbar().init(U)}}function z(){var S={};S.btn_start=function(){window.sessionStorage[statesessionname]="start"};var Q=n();var R=$.extend(S,Q);window.top.minibar.init(R)}function q(){var S={};S.btn_stop=function(){window.sessionStorage[statesessionname]="stop"};var Q=n();var R=$.extend(S,Q);window.top.minibar.init(R)}function n(){var R={};var Q=parseInt(window.sessionStorage[prizeindexsessionname]);if(Q>0){R.btn_prev=function(){window.sessionStorage[statesessionname]="prev"}}if((Q+1)<prizesdata.length){R.btn_next=function(){window.sessionStorage[statesessionname]="next"}}return R}function J(){H.on("click",function(){x()});L.on("click",function(){E()});j.on("click",function(){y()});D.on("click",function(){l()});p.on("keyup",function(){v=p.val()})}function t(){hotkeys("up",function(Q){event.preventDefault();l()});hotkeys("down",function(Q){event.preventDefault();y()});hotkeys("left",function(Q){event.preventDefault();x()});hotkeys("right",function(Q){event.preventDefault();E()});hotkeys("space",function(Q){event.preventDefault();if(h==1){u();return false}if(h==2){s();return false}console.log(h)})}function F(){$(".cd_xz .main_menu,#winnerlist").css({"background-color":B.layercolor});$(".words_jx,.jpmc,.hjrs_qty").css({"color":B.prizefontcolor});$(".words_cqrs,.jp,.hjmd,.hjrs").css({"color":B.fontcolor});$(".main_tb li span").css({"color":B.winnerfontcolor});$(".main_mask").css({"background-color":B.fullscreenmaskcolor});$(".mask").css({"box-shadow":"0 0 0 2000px "+B.maskcolor,})}function w(){var Q=window.sessionStorage[statesessionname];if(Q=="start"){window.sessionStorage[statesessionname]="idle";u()}if(Q=="stop"){window.sessionStorage[statesessionname]="idle";s()}if(Q=="next"){window.sessionStorage[statesessionname]="idle";E()}if(Q=="prev"){window.sessionStorage[statesessionname]="idle";x()}setTimeout(w,500)}return{"init":function(){window.sessionStorage[prizeindexsessionname]=0;w();F();A();J();t();G();z()}}}();$(document).ready(function(){metapc().init(4096,14,4096);index.init()});