jQuery(document).ready(function(c){var t=c(".cd-tabs");function a(t){var e=parseInt(t.children(".cd-tabs-navigation").width()),a=parseInt(t.width());t.scrollLeft()>=e-a?t.parent(".cd-tabs").addClass("is-ended"):t.parent(".cd-tabs").removeClass("is-ended")}t.each(function(){var t=c(this),d=t.find("ul.cd-tabs-navigation"),s=t.children("ul.cd-tabs-content"),e=t.find("nav");d.on("click","a",function(t){t.preventDefault();var e=c(this);if(!e.hasClass("selected")){var a=e.data("content"),n=s.find('li[data-content="'+a+'"]'),i=n.innerHeight();d.find("a.selected").removeClass("selected"),e.addClass("selected"),n.addClass("selected").siblings("li").removeClass("selected"),s.animate({height:i},200)}}),a(e),e.on("scroll",function(){a(c(this))})}),c(window).on("resize",function(){t.each(function(){var t=c(this);a(t.find("nav")),t.find(".cd-tabs-content").css("height","auto")})});var e,n,i,d,s,o,h,r,g,l;function u(){for(var t=0,e=pageinfo.pagedata.signs.length;t<e;t++)g[t]=new Sketchpad({element:"#signarea_"+(t+1),width:c(".main-xz").width(),height:c(".main-xz").height()}),l[t]=c("#signarea_"+(t+1));h.on("click",function(){var t=c(this).attr("data"),e=t-1,a=l[e][0],n=function(t){var e=t.getContext("2d"),a=function(t,e,a){for(var n=t.data,i=e,d=a,s=0,c=0,o=1,h=0,r=0,g=n.length;r<g;r+=4)o%e==0&&(h++,o=0),0<n[r+3]&&(i=o<i?o:i,d=h<d?h:d,s=o<s?s:o,c=h<c?c:h),o++;return{x:i,y:d,w:s-i,h:c-d}}(e.getImageData(0,0,t.width,t.height),t.width,t.height),n=e.getImageData(a.x,a.y,a.w,a.h),i=document.getElementById("cutoutcanvas");return i.width=a.w,i.height=a.h,i.getContext("2d").putImageData(n,0,0,0,0,a.w,a.h),i.toDataURL("image/png")}(a);return c.ajax({url:"/Modules/module.php?m=page&c=front&a=ajaxSaveSign",type:"post",data:{id:pageinfo.id,index:e,base64:n},dataType:"json",success:function(t){0<t.code&&alert("保存成功！")}}),!1}),r.on("click",function(){var t=c(this).attr("data");g[t-1].clear()})}e=c(".cd-tabs").height(),n=c(".cd-tabs-content"),i=n.height(),d=n.position().top,s=(e-i)/2,o=c(document).height(),n.height(o-2*s-d-10),c(".main-xz").height(n.height()-198),(h=c(".btn-confirm"),r=c(".btn-reset"),g=[],l=[],{init:function(){u()}}).init()});