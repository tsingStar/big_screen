requirejs.config({baseUrl:"",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys",metapc:"/assets/js/meta-pc.min",tweenmax:"/assets/plugs/greensock-js/src/minified/TweenMax.min"},shim:{tweenmax:{exports:"TweenMax"},bindhotkeys:{deps:["hotkeys"]}}}),requirejs(["jquery","tweenmax","metapc","hotkeys","bindhotkeys"],function(p,d,i){var g=p(".container"),h=g.width(),r=g.height();function s(n,i,t){var s=p("#signbox"+t);if(i){if(n.img!=i.img){var a;if(0==i.img)s.find("span").text("签名"+(t+1)),s.css({background:"","background-size":"","background-color":"aliceblue",opacity:.6});else s.find("span").text(""),(a=new Image).src=i.path,s.css({opacity:0}),p(a).on("load",function(){var i=p("#displaysign");i.html(""),signimage=p(a),signimage.appendTo(i),i.css({display:"block"});var t=g.position().left+s.position().left,o=g.position().top+s.position().top;signimage.css({position:"absolute",width:"60%"}),d.to(signimage,3,{left:t,top:o,width:n.pos.w*h/100,height:n.pos.h*r/100,opacity:0,onUpdate:function(){var i=1-parseFloat(signimage.css("opacity"));s.css({opacity:i})},onComplete:function(){i.css({display:"none"})}});var e=a.height/a.width;n.pos.h/n.pos.w<e?s.css({background:"url("+n.path+") no-repeat","background-size":"auto 100%"}):s.css({background:"url("+n.path+") no-repeat","background-size":"100% auto"})});pageinfo.pagedata.signs[t].img=i.img,pageinfo.pagedata.signs[t].path=i.path}}else 0<n.img&&(s.find("span").text(""),(a=new Image).src=n.path,p(a).on("load",function(){var i=a.height/a.width,t=n.pos.w*h;n.pos.h*r/t<i?s.css({background:"url("+n.path+") no-repeat","background-size":"auto 100% ",opacity:1}):s.css({background:"url("+n.path+") no-repeat","background-size":"100% auto ",opacity:1})}))}p(document).ready(function(){n().init(),o().init(),function n(){p.ajax({url:"/Modules/module.php?m=page&c=front&a=ajaxGetSign",type:"get",dataType:"json",data:{id:pageinfo.id},success:function(i){if(0<i.code)for(var t=i.data.pagedata.signs,o=0,e=t.length;o<e;o++)s(pageinfo.pagedata.signs[o],t[o],o);setTimeout(function(){n()},1e3)}})}(),u.init()});var c,e,t,o=function(){return{init:function(){!function(){for(var i=pageinfo.pagedata.signs,t="",o=0,e=i.length;o<e;o++)t+='<div id="signbox{num}" data="{num}" class="box" style="z-index:999;position: absolute;"><span>签名{signnum}</span><div class="coor"></div></div>'.replace(/\{num\}/g,o).replace("{signnum}",o+1);p(t).appendTo(".container");var n=p(".box");for(o=0,e=i.length;o<e;o++)p(n[o]).css({left:i[o].pos.x*h/100,top:i[o].pos.y*r/100,width:i[o].pos.w*h/100,height:i[o].pos.h*r/100}),0<i[o].img&&s(i[o],null,o);n.resizeQrcodeBox({updatepos:a})}()}}},a=function(t,o){p.ajax({url:"/Modules/module.php?m=page&c=front&a=ajaxSavePos",type:"post",dataType:"json",data:{index:t,pos:o,id:pageinfo.id},success:function(i){pageinfo.pagedata.signs[t].pos.x=o.x,pageinfo.pagedata.signs[t].pos.y=o.y,pageinfo.pagedata.signs[t].pos.w=o.w,pageinfo.pagedata.signs[t].pos.h=o.h,s(pageinfo.pagedata.signs[t],null,t)}})},n=function(){var t=document.getElementById("contract"),o=1,e=1;p(t).width(h),p(t).height(r);var n=t.getContext("2d");function i(){var i=new Image;i.src="/imageproxy.php?id="+pageinfo.pagedata.img,i.onload=function(){t.width=i.width,t.height=i.height,o=t.width/h,e=t.height/r,n.drawImage(i,0,0,i.width,i.height,0,0,o*h,e*r)}}return{init:function(){if(pageinfo.pagedata.img<=0)return g.hide(),!1;i()},redraw:function(){n.clearRect(0,0,t.width,t.height),i()}}},u={init:function(){window.sessionStorage.bgpath=pageinfo.pagedata.bg_path,window.sessionStorage.bgmusic=pageinfo.pagedata.bgmusic_path+"|"+pageinfo.pagedata.bgmusic_switch,function(){if(1<pages.length){for(var i=[],t=0,o=pages.length;t<o;t++){var e=pageinfo.id==pages[t].id?1:2;i[t]={name:pages[t].title,action:"/Modules/module.php?m=page&c=front&a=index&id="+pages[t].id,icon:"icondanye",current:e}}window.top.roundbar().init(i)}}()}};function m(i,t){this.$element=i,this.defaults={w:5,h:5,y:5,x:5},this.options=c.extend({},this.defaults,t),this.parentdiv=c(this.$element).parent();var o=this.parentdiv.width(),e=this.parentdiv.height(),n=this.parentdiv.offset().left,s=this.parentdiv.offset().top;this.options.w=this.options.w*o/100,this.options.h=this.options.h*e/100,this.options.x=this.options.x*n/100,this.options.y=this.options.y*s/100,this.options.minX=n,this.options.maxX=n+o,this.options.minY=s,this.options.maxY=s+e,this.boxesids=[];for(var a=0,p=this.$element.length;a<p;a++)this.boxesids[a]=c(this.$element[a]).attr("id")}c=jQuery,e=window,t=document,m.prototype={resize:function(a){var p=this;function o(t){c("#"+t).find(".coor").on("mousedown",function(i){i.stopPropagation(),p.move=t,p.action="resize"}),c("#"+t).find(".coor").show()}c(t).off("mousedown"),c(t).off("mousemove"),c(t).off("mouseup"),c(t).on("mousedown",function(i){var t=(i=i||e.event).target||i.srcElement;for(c(".coor").hide();t;){if(t.id&&0<=c.inArray(t.id,p.boxesids))return p.move=t.id,void o(t.id);t=t.parentNode}}),c(t).on("mousemove",function(i){""!=p.move&&("resize"==p.action?p.resizebox(i,c("#"+p.move)):p.movebox(i,c("#"+p.move)))}),c(t).on("mouseup",function(i){if(""!=p.move){var t=p.parentdiv.width(),o=p.parentdiv.height(),e=c("#"+p.move),n={x:Math.round(e.position().left/t*1e4)/100,y:Math.round(e.position().top/o*1e4)/100,w:Math.round(e.width()/t*1e4)/100,h:Math.round(e.height()/o*1e4)/100},s=e.attr("data");a(s,n)}p.action="",p.move=""}),c.extend(p,{move:"",action:"",movebox:function(i,t){var o=0<i.pageX-p.options.minX?i.pageX-p.options.minX:0,e=c(t).width(),n=(o=p.options.maxX-i.pageX<e?p.options.maxX-e-p.options.minX:o,0<i.pageY-p.options.minY?i.pageY-p.options.minY:0),s=c(t).height();n=p.options.maxY-i.pageY<s?p.options.maxY-s-p.options.minY:n,c(t).css({left:o,top:n})},resizebox:function(i,t){var o=i.pageX-t.position().left-p.options.minX;o=o<90?90:o,t.position().left+o+p.options.minX>p.options.maxX&&(o=p.options.maxX-t.position().left-p.options.minX);var e=i.pageY-t.position().top-p.options.minY;t.position().top+e+p.options.minY>p.options.maxY&&(e=p.options.maxY-t.position().top-p.options.minY),e=e<30?30:e,t.css({width:o,height:e})}})}},c.fn.resizeQrcodeBox=function(i){this.parentdiv=c(this).parent();var t=c(this.parentdiv).width(),o=c(this.parentdiv).height(),e=(i=c.extend({},{w:5,h:5,y:5,x:5},i),c.extend({},i));i.x<0&&(e.x=0),i.y<0&&(e.y=0),(i.x+i.w)/100*t>t&&(e.x=t-i.w/100*t),(i.y+i.h)/100*o>o&&(e.y=o-i.h/100*t),new m(c(this),e).resize(e.updatepos)}});