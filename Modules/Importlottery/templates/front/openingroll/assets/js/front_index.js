requirejs.config({baseUrl:"",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys",metapc:"/assets/js/meta-pc.min",animatejs:"/assets/js/jquery.animate.min"},shim:{bindhotkeys:{deps:["hotkeys"]},animatejs:{deps:["jquery"]}}}),requirejs(["jquery","metapc","hotkeys","bindhotkeys","animatejs"],function(w,t){var o="importlottery_"+lotteryconfig.id+"_",e=o+"fangchan",g=o+"fangchan_prizeindex",m=lotteryconfig.themeconfig,n=!1;function i(){return w.ajax({url:"/Modules/module.php?m=importlottery&c=front&a=ajaxGetRandData",type:"get",dataType:"json"})}window.sessionStorage[g]=window.sessionStorage[g]?parseInt(window.sessionStorage[g]):0,w(document).ready(function(){l.init(),q.init(),t.init(4096,14,4096)});var a,r,s,d,l=(a=[],r=[],d=s=0,{init:function(){f(),h()},start:function(){window.sessionStorage[e]="start"},stop:function(){window.sessionStorage[e]="stop"},prev:function(){window.sessionStorage[e]="prev"},next:function(){window.sessionStorage[e]="next"}});function f(){x.hide(0),z.hide(0);var t=parseInt(window.sessionStorage[g]);window.sessionStorage[e]="idle",function(t){(function(t){return w.ajax({url:"/Modules/module.php?m=importlottery&c=front&a=ajax_act_get_ready&prizeid="+t,type:"get",dataType:"json"})})(prizesdata[t].id).done(function(t){0<t.code&&(s=t.data.count,d=t.data.prizenum,0<t.data.winners.length?(a=t.data.winners,x.hide(500,function(){z.show(a)}),q.showCommonBtns()):(x.init(),x.show(),q.showStartBtn()))}).fail(function(){alert("请检查一下您的网络，是否断网了")}).always(function(){}),i().done(function(t){0<t.code&&(r=t.data)}).fail(function(){alert("请检查一下您的网络，是否断网了")}).always(function(){})}(t)}function c(){var o=s<d?s:d;if(o<=0)return alert("没有人或者奖品可以用来抽了，请检查一下导入的数据和奖品剩余数量哦！"),!1;n=!0,x.hide(500,function(){!function(o){0==r.length?i().done(function(t){0<t.code&&(r=t.data,o(r))}).fail(function(){alert("请检查一下您的网络，是否断网了")}).always(function(){}):o(r)}(function(t){z.show(),z.roll(t,o)})}),q.showStopBtn()}function u(){n=!1;var t=window.sessionStorage[g],o=s<d?s:d;(function(t,o){return w.ajax({url:"/Modules/module.php?m=importlottery&c=front&a=ajax_act_get_result&num="+t+"&prizeid="+o,type:"get",dataType:"json"})})(o,prizesdata[t].id).done(function(t){0<t.code&&(d-=o,s-=o,z.stoproll(t.data))}).fail(function(){alert("请检查一下您的网络，是否断网了")}).always(function(){}),q.showCommonBtns()}function h(){var t=window.sessionStorage[e];"start"==t&&(window.sessionStorage[e]="idle",c()),"stop"==t&&(window.sessionStorage[e]="idle",u()),"next"==t&&(window.sessionStorage[e]="idle",function(){var t=parseInt(window.sessionStorage[g]);if(prizesdata.length<=t+1)return alert("当前已经是最后一轮抽奖了哦");t+=1,window.sessionStorage[g]=t,f()}()),"prev"==t&&(window.sessionStorage[e]="idle",function(){var t=parseInt(window.sessionStorage[g]);if(t<=0)return alert("当前已经是第1轮抽奖了哦");t-=1,window.sessionStorage[g]=t,f()}()),"result"==t&&(window.sessionStorage[e]="idle",_.toggle()),setTimeout(h,500)}var p,y,b,v,S,j,x=(p=w(".page-1"),y=p.find(".dyl"),b=p.find(".wz2"),v=p.find(".hdjp"),{init:function(){y.css({color:m.fontcolor}),b.css({color:m.prizefontcolor}),function(){var t=parseInt(window.sessionStorage[g]);y.text("第"+(t+1)+"轮"),b.text(prizesdata[t].prizename),v.attr("src",prizesdata[t].formatedtext.text)}()},show:function(){p.show().animateControl("fadeIn")},hide:function(t,o){p.fadeOut(t,o)}}),z=function(){var r=w(".page-2"),s=r.find(".yj"),d=r.find(".main_tb"),a=null,l=null;function f(){if(0<this.cols.length)return this.cols;for(var t=0,o=lotteryconfig.metadata.length;t<o;t++)"1"==lotteryconfig.metadata[t].show&&this.cols.push(lotteryconfig.metadata[t].name);return this.cols}function c(t){if(t<=0)return"";var o="<table><thead></thead><tbody></tbody></table>",n="";10<t&&(n=" table-2",20<t&&(n+=" row-40"),o="<table class='"+n+"' ><thead></thead><tbody></tbody></table><table class='"+n+"'><thead></thead><tbody></tbody></table>"),w(o).appendTo(d),function(){var t=d.find("table").find("thead");t.find("tr").remove();for(var o=f(),n="<tr>",e=0,i=o.length;e<i;e++){var a="<th>"+o[e]+"</th>";n+=a}w(n+="</tr>").appendTo(t)}()}function u(t){if(null==l||0==l.length){var o=d.find("tbody");l=o.find("tr")}for(var n=function(t,o,n){for(var e=[],i=0;i<n;i++){var a=t+Math.floor((o-t)*Math.random());e.push(a)}return e}(0,t.length,l.length),e=0,i=l.length;e<i;e++)p(l[e],t[n[e]].datarow);a=setTimeout(function(){u(t)},100)}function h(t){var o=d.find("tbody");o.find("tr").remove(),l=null;var n=function(t){for(var o="<tr>",n=f(),e=0,i=n.length;e<i;e++)o+="<td></td>";o+="</tr>";for(var a="",e=0;e<t;e++)a+=o;return a}(t);if(1<o.length)for(var e=0,i=(l=(l=w(n).find("tr")).prevObject).length;e<i;e++)w(l[e]).appendTo(o[e%2]);else w(n).appendTo(o);20<t?o.find("td").css({"background-color":m.tablecolor,filter:"drop-shadow(0 0 6px "+m.tablecolor+")",color:m.tablefontcolor}):o.find("td").css({"background-color":m.tablecolor,filter:"drop-shadow(0 0 2px "+m.tablecolor+")",color:m.tablefontcolor})}function p(t,o){for(var n=w(t).find("td"),e=0,i=f().length;e<i;e++)w(n[e]).text(o[e])}return this.cols=[],{show:function(t){var o=0;t&&(o=t.length),function(t){20<t?d.find("th").css({"background-color":m.tabletitlecolor,filter:"drop-shadow(0 0 2px "+m.tabletitlecolor+")","-webkit-filter":"drop-shadow(0 0 2px "+m.tabletitlecolor+")",color:m.tabletitlefontcolor}):d.find("th").css({"background-color":m.tabletitlecolor,filter:"drop-shadow(0 0 6px "+m.tabletitlecolor+")","-webkit-filter":"drop-shadow(0 0 6px "+m.tabletitlecolor+")",color:m.tabletitlefontcolor})}(o),function(t){var o=window.sessionStorage[g];if(d.html(""),t){var n=t.length;c(n),h(n);for(var e=d.find("tbody").find("tr"),i=0,a=e.length;i<a;i++)p(e[i],t[i].datarow)}s.text(prizesdata[o].prizename),r.fadeIn(500)}(t)},hide:function(t,o){r.fadeOut(t,o)},roll:function(t,o){c(o),h(o),u(t)},stoproll:function(t){!function(t){null==l&&(l=tbody.find("tr")),clearTimeout(a);for(var o=0,n=l.length;o<n;o++)p(l[o],t[o].datarow)}(t)}}}(),k="hide",_=(S=w(".page-3"),j=null,{toggle:function(){"hide"==k?I():(S.animateControl("zoomOut",function(){S.hide()}),w(".zz").animateControl("fadeOut",function(){w(".zz").hide()}),k="hide")}});function T(t){if(null==j){j={};for(var o=0,n=prizesdata.length;o<n;o++)j[prizesdata[o].id]=prizesdata[o]}return j[t]}function I(){var s=w(".grid").find("tbody");s.html("");var t=w(".grid").find("thead");t.html("");for(var d=["奖项"],o=0,n=lotteryconfig.metadata.length;o<n;o++)"1"==lotteryconfig.metadata[o].show&&d.push(lotteryconfig.metadata[o].name);var e="<tr>";for(o=0,n=d.length;o<n;o++){e+='<th><span class="tab-link">'+d[o]+"</span></th>"}w(e+="</tr>").appendTo(t),e="",w.ajax({url:"/Modules/module.php?m=importlottery&c=front&a=ajaxGetAllResult",type:"get",dataType:"json"}).done(function(t){if(0<t.code){for(var o="",n=0,e=t.data.length;n<e;n++){var i=T(t.data[n].prizeid);o+="<tr>";for(var a=0,r=d.length;a<r;a++)o+=0==a?"<td>"+i.prizename+"</td>":"<td>"+t.data[n].datarow[a-1]+"</td>";o+="</tr>"}w(o).appendTo(s)}w(".zz").show(),S.show().animateControl("zoomIn"),k="show"}).fail(function(){alert("请检查一下您的网络，是否断网了")}).always(function(){})}var q={init:function(){window.sessionStorage.bgpath=m.bg_path,window.sessionStorage.bgmusic=m.bgmusic_path+"|"+m.bgmusic_switch,function(){if(1<lotteryconfigs.length){for(var t=[],o=["","icon3dcj","iconfdc"],n=0,e=lotteryconfigs.length;n<e;n++){var i=configid==lotteryconfigs[n].id?1:2;t[n]={name:lotteryconfigs[n].title,action:"/Modules/module.php?m=importlottery&c=front&a=index&id="+lotteryconfigs[n].id,icon:o[lotteryconfigs[n].themeid],current:i}}window.top.roundbar().init(t)}}()},showStartBtn:function(){!function(){var t={btn_start:function(){window.sessionStorage[e]="start"}},o=B(),n=w.extend(t,o);window.top.minibar.init(n)}()},showStopBtn:function(){!function(){var t={btn_stop:function(){window.sessionStorage[e]="stop"}},o=B(),n=w.extend(t,o);window.top.minibar.init(n)}()},showCommonBtns:function(){!function(){var t=B();window.top.minibar.init(t)}()}};function B(){var t={},o=parseInt(window.sessionStorage[g]);return 0<o&&(t.btn_prev=function(){window.sessionStorage[e]="prev"}),o+1<prizesdata.length&&(t.btn_next=function(){window.sessionStorage[e]="next"}),t.btn_result=function(){window.sessionStorage[e]="result"},t}hotkeys("left",function(t){0==t.repeat&&l.prev()}),hotkeys("right",function(t){0==t.repeat&&l.next()}),hotkeys("space",function(t){0==t.repeat&&(0==n?l.start():l.stop())})});