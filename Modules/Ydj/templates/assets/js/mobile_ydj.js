$(document).ready(function(){window.shakeaudio=$("#ShakeAudio")[0],window.winaudio=$("#WinAudio")[0],$(document).on("WeixinJSBridgeReady",function(){$(window.shakeaudio).load(),$(window.winaudio).load()})});var checkstatus_timer=null,gameendmessage="本轮活动已经结束,你可以刷新页面来获取新一轮活动",customerevent="shake",shakeevent=new Shake({threshold:15,timeout:300});$(function(){$(".shake-icon").css({"background-image":"url("+THEMEDATA.themedata.mobileshakeimage+")","background-repeat":"no-repeat","background-size":"cover"})}),bubbly(),isbind=!1;var rate=5e3;function checkstatus(){ajax_act_get_status().done(function(n){if(n.code<=0)return _loading_toast._show(n.message),!1;if(n.data.configid==YDJ_CONFIG.id)return YDJ_CONFIG.status=n.data.status,1==n.data.status?(_loading_toast._show(n.message),!1):2==n.data.status?(startlisten(),_loading_toast._show(n.message),console.log(n.data),0<n.data.prizeid&&showprizeinfo(n.data.prizeid),!1):3==n.data.status?(endlisten(),_loading_toast._show(n.message),!1):void 0;return _loading_toast._show("3秒后自动刷新页面获取最新的活动数据"),setTimeout(function(){window.location.reload()},3e3),!1}).fail(function(){_loading_toast._longshow("您的网络可能出现了故障!")}).always(function(){checkstatus_timer=setTimeout(checkstatus,rate)})}function showprizeinfo(n){n?(playwinsound(),$("#award").find("img").attr("src",PRIZES[n].formatedtext.text),$("#award").find("p").text("恭喜你获得了"+PRIZES[n].prizename+"!")):($("#award").find("img").attr("src","Ydj/templates/assets/images/noaward.jpg"),$("#award").find("p").text("很遗憾您没有获得奖品!")),$("#award").slideDown(500),window.isshowprizeinfo=!0}function playshakesound(){null!=typeof WeixinJSBridge?(window.shakeaudio.paused||window.shakeaudio.ended)&&window.shakeaudio.play():$(document).on("WeixinJSBridgeReady",function(){$(window.shakeaudio).load(),$(window.shakeaudio).on("canplaythrough",function(){(window.shakeaudio.paused||window.shakeaudio.ended)&&window.shakeaudio.play()})})}function playwinsound(){null!=typeof WeixinJSBridge?(window.winaudio.paused||window.winaudio.ended)&&window.winaudio.play():$(document).on("WeixinJSBridgeReady",function(){$(window.winaudio).load(),$(window.winaudio).on("canplaythrough",function(){(window.winaudio.paused||window.winaudio.ended)&&window.winaudio.play()})})}$(document).ready(function(){if(2==CANJOIN)return _loading_toast._longshow("您已经得过奖了，无法参与本轮游戏。"),void setTimeout(function(){window.location.reload()},1e4);3==YDJ_CONFIG.status&&_loading_toast._longshow(gameendmessage),2==YDJ_CONFIG.status&&startlisten(),clearTimeout(checkstatus_timer),checkstatus()}),window.isshowprizeinfo=!1,$(document).ready(function(){$("#award").on("touchend",function(){$(this).slideUp(500),window.isshowprizeinfo=!1})}),window.shakeaudio=null,window.winaudio=null;var startrunning=!1,stopshakingtimer=null,running=function(){if(1==window.isshowprizeinfo)return startrunning=!1,!($shakestatus="idle");playshakesound(),startrunning=!0,clearTimeout(stopshakingtimer),stopshakingtimer=setTimeout(function(){startrunning=!1,$shakestatus="idle"},1e3)},isrunning=!1,watchrunningstatustimer=null,$shakestatus="idle";function watchrunningstatus(){watchrunningstatustimer=setTimeout(function(){watchrunningstatus()},1e3),0!=startrunning&&($shakestatus="shaking")}function ajax_act_get_status(){return $.ajax({url:"/Modules/module.php?m=ydj&c=mobile&a=ajax_act_get_status",data:{userid:USERINFO.id,action:$shakestatus},type:"get",dataType:"json"})}function startlisten(){0==isbind&&(shakeevent.start(),$(window).on(customerevent,running),watchrunningstatus(),isbind=!0)}function endlisten(){null!=watchrunningstatustimer&&clearTimeout(watchrunningstatustimer),1==isbind&&($(window).off(customerevent,running),shakeevent.stop(),isbind=!1)}