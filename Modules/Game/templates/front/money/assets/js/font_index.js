requirejs.config({baseUrl:".",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys"},shim:{bindhotkeys:{deps:["hotkeys"]}}}),requirejs(["jquery","bindhotkeys"],function(r){window.getdatatimer=null;var n=0,o=0,u=r(".welcome_box"),l=r(".cutdown-start");function e(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,function(){var t=r(window.top.document).find("#box img").attr("src");t=(t=t.replace("./","/")).trim(),u.find("img.qrimg").attr("src",t),u.slideDown()}()),radarusers=radarusers.concat(t.userlist),function(t){r(".main_right .joinNum").html(t+"人")}(t.num),function(){if(!(radarusers.length<=0)){r("#Audio_NewPlayer")[0].play();var t=radarusers.shift(),e='<img class="avatar default" src="'+t.avatar+'">';10<r(".avatar.default").length?r(".avatar.default").eq(0).animate({opacity:0},1e3,function(){r(this).remove(),r(e).appendTo(".list").animate({opacity:.7},500)}):r(".avatar.default").eq(radaruserindex).attr("src",t.avatar),radaruserindex++}}()}function a(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,u.slideUp(),d(),g.resize()),n=0==n?Math.round((new Date).getTime()/1e3):n;var e=Math.round((new Date).getTime()/1e3)-n;if(o=1<=o?1:e/GAMECONFIG.themeconfig.duration,t)for(var a=0,i=t.length;a<i;a++)g.showprogress(a,t[a]),h=h>parseInt(t[a].point)?h:parseInt(t[a].point);var s=0<GAMECONFIG.themeconfig.duration-e?GAMECONFIG.themeconfig.duration-e:0;l.html(s),1==o&&c("stop").done(function(t){t.code<0&&alert(t.message)})}function i(){var t=window.sessionStorage.game;"start"==t&&(window.sessionStorage.game="idle",c("start").done(function(t){a()})),"reset"==t&&(window.sessionStorage.game="idle",c("reset").done(function(t){clearTimeout(getdatatimer),getdatatimer=null,alert(t.message),0<t.code&&setTimeout(function(){window.location.reload()},3e3)})),setTimeout(i,500)}function s(){t().done(function(t){if(0<t.code)return GAMECONFIG.status=t.config.status,1==t.config.status&&(e(t.users),getdatatimer=setTimeout(s,1e3)),2==t.config.status&&(getdatatimer=setTimeout(s,1e3),a(t.users)),void(3==t.config.status&&function(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,f.show(t))}(t.users))}).fail(function(){alert("您的网络不稳定,点确定后,系统会重新连接,如果再次弹出这个提示,请检查网络,或者更换网络"),clearTimeout(getdatatimer),getdatatimer=setTimeout(s,1e3)})}r(document).ready(function(){GAMECONFIG?(d(),s(),i()):alert("后台没有设置游戏,请先设置一轮游戏哦")}),radarusers=[],radaruserindex=0,laststatus=0;var t=function(){return r.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxGetData",type:"get",dataType:"json"})},c=function(t){return r.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxPostData",type:"post",dataType:"json",data:{action:t}})};function d(){var t={};if(1==GAMECONFIG.status&&(t.btn_start=function(){window.sessionStorage.game="start"}),2!=GAMECONFIG.status&&3!=GAMECONFIG.status||(t.btn_reset=function(){window.sessionStorage.game="reset"}),window.top.minibar.init(t),window.sessionStorage.bgpath=GAMECONFIG.themeconfig.bg_path,window.sessionStorage.bgmusic=GAMECONFIG.themeconfig.bgmusic_path+"|"+GAMECONFIG.themeconfig.bgmusic_switch,1<CONFIGS.length){for(var e=[],a=["iconyyy","iconxqc","iconhzsq","iconsq","iconjzsf","iconsaipao","iconslz","iconsc","iconsm","iconst","iconqbtzj","icon61","iconqixi","iconzhongqiujie"],i=["iconyyy","默认汽车","猴子爬树","数钱游戏","金猪送福","赛跑","赛龙舟","赛车","赛马","游艇","丘比特之箭","欢乐六一","爱在七夕","浓情中秋"],s=0,n=CONFIGS.length;s<n;s++){var r=GAMECONFIG.id==CONFIGS[s].id?1:2;e[s]={name:i[CONFIGS[s].themeid],action:"/Modules/module.php?m=game&c=front&a=index&id="+CONFIGS[s].id,icon:a[CONFIGS[s].themeid],current:r}}window.top.roundbar().init(e)}}var m,h=0,g={tracklist_elm:null,track_elm:null,width:0,height:0,size:0,init:function(){null==this.tracklist_elm&&(this.tracklist_elm=r(".shu-rank-list"),this.track_elm=this.tracklist_elm.children()),console.log(l.height()),l.html(""),l.css({"margin-left":-l.width()/2+"px","margin-top":-l.height()/2+"px","font-size":.7*l.height()+"px","line-height":l.height()+"px"}),l.show(),this.height=this.tracklist_elm.height()/10,this.width=this.tracklist_elm.width()-this.height,this.size=this.height>this.width?this.width:this.height},resize:function(){this.init()},ph_arr:[],oldprogress:[],showprogress:function(t,e){var a=this;null==this.oldprogress[t]&&(this.oldprogress[t]=0);var i=this.calcProgress(e.point);null==this.tracklist_elm&&this.resize(),r(a.track_elm[t]).find(".shu-rank-item-body").css({height:i+"px"}),r(a.track_elm[t]).find(".shu-rank-item-info img").attr("src",e.avatar),r(a.track_elm[t]).find(".shu-rank-item-info .shu-rank-item-name").text(e.nickname),r(a.track_elm[t]).find(".shu-rank-item-info .shu-rank-item-score").text(e.point)},maxpoint:0,calcProgress:function(t){console.log(t);var e=Math.floor(t/25e3*400);return e=400<e?400:e}},f={result_layer:null,result_label:null,result_cap:null,player_tp:r("<div class='player'><div class='head'></div><div class='nickname'></div></div>"),showGameoverPage:function(){r(".paomabeijing2,.paomabeijing,.tracklist,.player .lunzia,.player .lunzib").removeClass("okplay"),this.result_layer.show().animateControl("bounceIn"),r("#Audio_Gameover")[0].play()},show:function(t){var e=this;this.result_layer=r(".rank_box"),winner_num=t.num,10<t.num?setTimeout(function(){e.showScore()},1e3):(this.showGameoverPage(),function(t){var e=t.length;if(1<=e&&t[0]){var a=r(".rank1");a.find("img").attr("src",t[0].avatar),a.find("p").text(t[0].nickname)}if(2<=e&&t[1]){var a=r(".rank2");a.find("img").attr("src",t[1].avatar),a.find("p").text(t[1].nickname)}if(3<=e&&t[2]){var a=r(".rank3");a.find("img").attr("src",t[2].avatar),a.find("p").text(t[2].nickname)}if(3<e)for(var i=r(".rank_others").find("li"),s=3,n=e;s<n;s++)r(i[s-3]).find(".avarta").attr("src",t[s].avatar),r(i[s-3]).find("p").text(t[s].nickname)}(t.users))},showScore:function(){showPage("/Modules/module.php?m=game&c=front&a=gameResult")}};showPage=function(t){var e=r('<div class="frame-dialog"><div class="phbphb" id="phbphb"><img src="/Modules/Game/templates/front/racing/assets/images/phb.png" class="phbtop" ><div class="phbk"><div class="phbbiaok"><iframe frameborder="0" src="'+t+'"></iframe></div></div></div></div>');e.css({"z-index":999}),e.appendTo("body").show()},(m=jQuery).fn.extend({animateControl:function(t,e){return this.addClass("animated "+t).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e&&e(),m(this).removeClass("animated "+t)}),this}})});