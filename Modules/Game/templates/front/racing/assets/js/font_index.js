requirejs.config({baseUrl:".",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys"},shim:{bindhotkeys:{deps:["hotkeys"]}}}),requirejs(["jquery","bindhotkeys"],function(u){window.getdatatimer=null;var i=0,n=0,r=u(".round-welcome");function e(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,function(){var t=u(window.top.document).find("#box img").attr("src");t=(t=t.replace("./","/")).trim(),r.find("img.qr").attr("src",t),r.slideDown()}()),radarusers=radarusers.concat(t.userlist),function(t){u(".round-label2 span").html("<i>"+t+"</i>").find("i").toggleClass("animate-rotate2")}(t.num),function(){if(!(radarusers.length<=0)){radaruserindex++,u("#Audio_NewPlayer")[0].play();var t=radarusers.shift(),e='<div id="shake_user_'+radaruserindex+'" class="user-item"><div class="user-img"><img src="'+t.avatar+'" /></div><p></p></div>';9<u(".user-item").length?u(".user-item").eq(0).animate({opacity:0},1e3,function(){u(this).remove(),u(e).appendTo(".users").animate({opacity:.7},500)}):u(e).appendTo(".users").animate({opacity:.7},500)}}()}function s(t){if(laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,r.slideUp(),h(),m.resize()),1==GAMECONFIG.themeconfig.durationtype){i=0==i?Math.round((new Date).getTime()/1e3):i;var e=Math.round((new Date).getTime()/1e3);n=1<=n?1:(e-i)/GAMECONFIG.themeconfig.duration}else n=1;if(t)for(var s=0,a=t.length;s<a;s++)m.showprogress(s,t[s]),d=d>parseInt(t[s].point)?d:parseInt(t[s].point);1==GAMECONFIG.themeconfig.durationtype?1==n&&o():parseInt(d)>=parseInt(GAMECONFIG.themeconfig.duration)&&o()}function a(){var t=window.sessionStorage.game;"start"==t&&(window.sessionStorage.game="idle",l("start").done(function(t){s()})),"reset"==t&&(window.sessionStorage.game="idle",l("reset").done(function(t){clearTimeout(getdatatimer),getdatatimer=null,alert(t.message),0<t.code&&setTimeout(function(){window.location.reload()},3e3)})),setTimeout(a,500)}function o(){l("stop").done(function(t){t.code<0&&alert(t.message)})}function c(){t().done(function(t){if(0<t.code)return GAMECONFIG.status=t.config.status,1==t.config.status&&(e(t.users),getdatatimer=setTimeout(c,1e3)),2==t.config.status&&(getdatatimer=setTimeout(c,1e3),s(t.users)),void(3==t.config.status&&function(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,p.show(t))}(t.users))}).fail(function(){alert("您的网络不稳定,点确定后,系统会重新连接,如果再次弹出这个提示,请检查网络,或者更换网络"),clearTimeout(getdatatimer),getdatatimer=setTimeout(c,1e3)})}u(document).ready(function(){GAMECONFIG?(h(),c(),a()):alert("后台没有设置游戏,请先设置一轮游戏哦")}),radarusers=[],radaruserindex=0,laststatus=0;var t=function(){return u.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxGetData",type:"get",dataType:"json"})},l=function(t){return u.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxPostData",type:"post",dataType:"json",data:{action:t}})};function h(){var t={};if(1==GAMECONFIG.status&&(t.btn_start=function(){window.sessionStorage.game="start"}),2!=GAMECONFIG.status&&3!=GAMECONFIG.status||(t.btn_reset=function(){window.sessionStorage.game="reset"}),window.top.minibar.init(t),window.sessionStorage.bgpath=GAMECONFIG.themeconfig.bg_path,window.sessionStorage.bgmusic=GAMECONFIG.themeconfig.bgmusic_path+"|"+GAMECONFIG.themeconfig.bgmusic_switch,1<CONFIGS.length){for(var e=[],s=["iconyyy","iconxqc","iconhzsq","iconsq","iconjzsf","iconsaipao","iconslz","iconsc","iconsm","iconst","iconqbtzj","icon61","iconqixi","iconzhongqiujie"],a=["iconyyy","默认汽车","猴子爬树","数钱游戏","金猪送福","赛跑","赛龙舟","赛车","赛马","游艇","丘比特之箭","欢乐六一","爱在七夕","浓情中秋"],i=0,n=CONFIGS.length;i<n;i++){var r=GAMECONFIG.id==CONFIGS[i].id?1:2;e[i]={name:a[CONFIGS[i].themeid],action:"/Modules/module.php?m=game&c=front&a=index&id="+CONFIGS[i].id,icon:s[CONFIGS[i].themeid],current:r}}window.top.roundbar().init(e)}}var d=0,m={tracklist_elm:null,track_elm:null,width:0,height:0,size:0,init:function(){null==this.tracklist_elm&&(this.tracklist_elm=u(".Panel.Track .tracklist"),this.track_elm=this.tracklist_elm.children()),this.height=this.tracklist_elm.height()/10,this.width=this.tracklist_elm.width()-this.height,this.size=this.height>this.width?this.width:this.height;var t,e,s;e={background:"url("+GAMECONFIG.themeconfig.startline_path+") repeat-y left center","background-size":"10px auto"},t={background:"url("+GAMECONFIG.themeconfig.endline_path+") repeat-y center center","background-size":"45px auto;"},s={background:"url("+GAMECONFIG.themeconfig.oddtrack_path+") repeat"},trackeven_css={background:"url("+GAMECONFIG.themeconfig.eventrack_path+") repeat"},u(".yyycj .paoma .xxx").css(e),u(".yyycj .zd").css(t),u(".yyycj ul li").css(s),u(".yyycj ul li:nth-child(2n)").css(trackeven_css)},resize:function(){this.init();var t=this;u(".Panel .Track").show(),this.track_elm.each(function(){u(this).css({height:t.height,"line-height":t.size+"px","font-size":3*t.size/5+"px"}).find(".ma").css({width:"0px",height:"100%"}),u(this).find(".tutu").css({width:"0px",height:"100%"})})},ph_arr:[],oldprogress:[],showprogress:function(t,e){null==this.oldprogress[t]&&(this.oldprogress[t]=0);var s=this.calcProgress(e.point);null==this.tracklist_elm&&this.resize(),null==this.ph_arr[t]&&(this.ph_arr[t]=u("#ph"+t));var a=this.ph_arr[t],i=u("#nc"+t,a);i.html(e.nickname);var n=u("#symbol"+t,a);n.attr("src",GAMECONFIG.themeconfig["avatar_"+t+"_path"]);var r=u("#tx"+t,a);t<3&&100<=s?r.attr("src","/Modules/Game/templates/front/racing/assets/images/p"+t+".jpg"):r.attr("src",e.avatar),ph_css={width:s+"%","margin-top":"-"+this.size/2+"px"},symbol_css={"max-height":this.size+"px"},n.css(symbol_css);var o=n.width()+4,c=o+(r.width()+4);r.css({right:o+"px"}),i.css({right:c+"px"}),s>this.oldprogress[t]&&(a.animate(ph_css,1e3),u("#pxh"+t).animate(ph_css,1e3),this.oldprogress[t]=s)},maxpoint:0,calcProgress:function(t){if(1!=GAMECONFIG.themeconfig.durationtype)return 100<=(e=Math.round(t/GAMECONFIG.themeconfig.duration*100))?100:e;this.maxpoint=this.maxpoint>parseInt(t)?this.maxpoint:parseInt(t);var e=Math.round(t/this.maxpoint*n*100);return console.warn("point:"+t+" maxpoint:"+this.maxpoint+" percent:"+n),e}},p={result_layer:null,result_label:null,result_cap:null,player_tp:u("<div class='player'><div class='head'></div><div class='nickname'></div></div>"),showGameoverPage:function(){this.result_layer.show(),this.result_label.show().addClass("pulse"),this.result_cup.hide(),u("#Audio_Gameover")[0].play()},show:function(t){var e,s=this;(this.result_layer=u(".result-layer"),this.result_label=u(".result-label",this.result_layer),this.result_cup=u(".result-cup",this.result_layer),winner_num=t.num,this.showGameoverPage(),3<t.num)?setTimeout(function(){s.showScore()},3e3):(e=t.users,window.setTimeout(function(){s.result_label.fadeOut(function(){s.result_cup.show(function(){1<=winner_num&&e[0]&&window.setTimeout(function(){var t=s.player_tp.clone().addClass("result").css({left:"50%","margin-left":"-65px",width:"160px",height:"160px",bottom:"150px"});t.find(".head").css({"background-image":"url("+e[0].avatar+")"}).addClass("shake"),t.find(".nickname").html(e[0].nickname),t.appendTo(s.result_cup).addClass("bounce"),console.log("1")},800),2<=winner_num&&e[1]&&window.setTimeout(function(){var t=s.player_tp.clone().addClass("result").css({left:"40px",width:"100px",height:"100px",bottom:"120px"});t.find(".head").css({"background-image":"url("+e[1].avatar+")"}).addClass("shake"),t.find(".nickname").html(e[1].nickname),t.appendTo(s.result_cup).addClass("bounce"),console.log("2")},1800),3<=winner_num&&e[2]&&window.setTimeout(function(){var t=s.player_tp.clone().addClass("result").css({right:"30px",width:"70px",height:"70px",bottom:"100px"});t.find(".head").css({"background-image":"url("+e[2].avatar+")"}).addClass("shake"),t.find(".nickname").html(e[2].nickname),t.appendTo(s.result_cup).addClass("bounce"),console.log("3")},2800)})}).removeClass("pulse")},1e3))},showScore:function(){showPage("/Modules/module.php?m=game&c=front&a=gameResult")}};showPage=function(t){var e=u('<div class="frame-dialog"><div class="phbphb" id="phbphb"><img src="/Modules/Game/templates/front/racing/assets/images/phb.png" class="phbtop" ><div class="phbk"><div class="phbbiaok"><iframe frameborder="0" src="'+t+'"></iframe></div></div></div></div>');e.css({"z-index":999}),e.appendTo("body").show()}});