requirejs.config({baseUrl:".",paths:{jquery:"/assets/js/jquery-3.3.1.min",hotkeys:"/assets/plugs/hotkeys-master/dist/hotkeys.min",bindhotkeys:"/wall/themes/meepo/assets/js/bindhotkeys"},shim:{bindhotkeys:{deps:["hotkeys"]}}}),requirejs(["jquery","bindhotkeys"],function(o){window.getdatatimer=null;var s=0,n=0,r=o(".welcome_box");function a(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,function(){var t=o(window.top.document).find("#box img").attr("src");t=(t=t.replace("./","/")).trim(),r.find("img.qrimg").attr("src",t),r.slideDown()}()),radarusers=radarusers.concat(t.userlist),function(t){o(".main_right .joinNum").html(t+"人")}(t.num),function(){if(!(radarusers.length<=0)){o("#Audio_NewPlayer")[0].play();var t=radarusers.shift(),a='<img class="avatar default" src="'+t.avatar+'">';10<o(".avatar.default").length?o(".avatar.default").eq(0).animate({opacity:0},1e3,function(){o(this).remove(),o(a).appendTo(".list").animate({opacity:.7},500)}):o(".avatar.default").eq(radaruserindex).attr("src",t.avatar),radaruserindex++}}()}function e(t){if(laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,r.slideUp(),m(),f.resize()),1==GAMECONFIG.themeconfig.durationtype){s=0==s?Math.round((new Date).getTime()/1e3):s;var a=Math.round((new Date).getTime()/1e3);n=1<=n?1:(a-s)/GAMECONFIG.themeconfig.duration}else n=1;if(t)for(var e=0,i=t.length;e<i;e++)f.showprogress(e,t[e]),h=h>parseInt(t[e].point)?h:parseInt(t[e].point);1==GAMECONFIG.themeconfig.durationtype?1==n&&u():parseInt(h)>=parseInt(GAMECONFIG.themeconfig.duration)&&u()}function i(){var t=window.sessionStorage.game;"start"==t&&(window.sessionStorage.game="idle",d("start").done(function(t){e()})),"reset"==t&&(window.sessionStorage.game="idle",d("reset").done(function(t){clearTimeout(getdatatimer),getdatatimer=null,alert(t.message),0<t.code&&setTimeout(function(){window.location.reload()},3e3)})),setTimeout(i,500)}function u(){d("stop").done(function(t){t.code<0&&alert(t.message)})}function c(){t().done(function(t){if(0<t.code)return GAMECONFIG.status=t.config.status,1==t.config.status&&(a(t.users),getdatatimer=setTimeout(c,1e3)),2==t.config.status&&(getdatatimer=setTimeout(c,1e3),e(t.users)),void(3==t.config.status&&function(t){laststatus!=GAMECONFIG.status&&(laststatus=GAMECONFIG.status,p.show(t))}(t.users))}).fail(function(){alert("您的网络不稳定,点确定后,系统会重新连接,如果再次弹出这个提示,请检查网络,或者更换网络"),clearTimeout(getdatatimer),getdatatimer=setTimeout(c,1e3)})}o(document).ready(function(){GAMECONFIG?(m(),c(),i()):alert("后台没有设置游戏,请先设置一轮游戏哦")}),radarusers=[],radaruserindex=0,laststatus=0;var t=function(){return o.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxGetData",type:"get",dataType:"json"})},d=function(t){return o.ajax({url:"/Modules/module.php?m=game&c=front&a=ajaxPostData",type:"post",dataType:"json",data:{action:t}})};function m(){var t={};if(1==GAMECONFIG.status&&(t.btn_start=function(){window.sessionStorage.game="start"}),2!=GAMECONFIG.status&&3!=GAMECONFIG.status||(t.btn_reset=function(){window.sessionStorage.game="reset"}),window.top.minibar.init(t),window.sessionStorage.bgmusic=GAMECONFIG.themeconfig.bgmusic_path+"|"+GAMECONFIG.themeconfig.bgmusic_switch,1<CONFIGS.length){for(var a=[],e=["iconyyy","iconxqc","iconhzsq","iconsq","iconjzsf","iconsaipao","iconslz","iconsc","iconsm","iconst","iconqbtzj","icon61","iconqixi","iconzhongqiujie"],i=["iconyyy","默认汽车","猴子爬树","数钱游戏","金猪送福","赛跑","赛龙舟","赛车","赛马","游艇","丘比特之箭","欢乐六一","爱在七夕","浓情中秋"],s=0,n=CONFIGS.length;s<n;s++){var o=GAMECONFIG.id==CONFIGS[s].id?1:2;a[s]={name:i[CONFIGS[s].themeid],action:"/Modules/module.php?m=game&c=front&a=index&id="+CONFIGS[s].id,icon:e[CONFIGS[s].themeid],current:o}}window.top.roundbar().init(a)}}var l,h=0,f={tracklist_elm:null,track_elm:null,width:0,height:0,size:0,init:function(){null==this.tracklist_elm&&(this.tracklist_elm=o(".houzik"),this.track_elm=this.tracklist_elm.children("div")),this.height=this.tracklist_elm.height()},resize:function(){this.init(),o(".pashuMain .houzi_user").removeClass("houzi_user")},ph_arr:[],oldprogress:[],showprogress:function(t,a){null==this.oldprogress[t]&&(this.oldprogress[t]=0);var e=this.calcProgress(a.point);null==this.tracklist_elm&&this.resize();var i=this.height-255;o(this.track_elm[t]).find(".topk").find("span").text(a.nickname),o(this.track_elm[t]).find(".mshakeuser_img").attr("src",a.avatar);var s=e*i/100;if(o(this.track_elm[t]).css("bottom",s+"px"),o(this.track_elm[t]).find(".bottomhz").find("img").attr("src","/Modules/Game/templates/front/monkey/assets/images/hz.gif"),s==i){var n=o(this.track_elm[t]).find(".guozik");o(n).css("opacity",1).css("top",i+"px")}},maxpoint:0,calcProgress:function(t){if(1!=GAMECONFIG.themeconfig.durationtype)return 100<=(a=Math.round(t/GAMECONFIG.themeconfig.duration*100))?100:a;this.maxpoint=this.maxpoint>parseInt(t)?this.maxpoint:parseInt(t);var a=Math.round(t/this.maxpoint*n*100);return console.warn("point:"+t+" maxpoint:"+this.maxpoint+" percent:"+n),a}},p={result_layer:null,result_label:null,result_cap:null,player_tp:o("<div class='player'><div class='head'></div><div class='nickname'></div></div>"),showGameoverPage:function(){o(".paomabeijing2,.paomabeijing,.tracklist,.player .lunzia,.player .lunzib").removeClass("okplay"),this.result_layer.show().animateControl("bounceIn"),o("#Audio_Gameover")[0].play()},show:function(t){var a=this;this.result_layer=o(".rank_box"),winner_num=t.num,10<t.num?setTimeout(function(){a.showScore()},1e3):(this.showGameoverPage(),function(t){var a=t.length;if(1<=a&&t[0]){var e=o(".rank1");e.find("img").attr("src",t[0].avatar),e.find("p").text(t[0].nickname)}if(2<=a&&t[1]){var e=o(".rank2");e.find("img").attr("src",t[1].avatar),e.find("p").text(t[1].nickname)}if(3<=a&&t[2]){var e=o(".rank3");e.find("img").attr("src",t[2].avatar),e.find("p").text(t[2].nickname)}if(3<a)for(var i=o(".rank_others").find("li"),s=3,n=a;s<n;s++)o(i[s-3]).find(".avarta").attr("src",t[s].avatar),o(i[s-3]).find("p").text(t[s].nickname)}(t.users))},showScore:function(){showPage("/Modules/module.php?m=game&c=front&a=gameResult")}};showPage=function(t){var a=o('<div class="frame-dialog"><div class="phbphb" id="phbphb"><img src="/Modules/Game/templates/front/racing/assets/images/phb.png" class="phbtop" ><div class="phbk"><div class="phbbiaok"><iframe frameborder="0" src="'+t+'"></iframe></div></div></div></div>');a.css({"z-index":999}),a.appendTo("body").show()},(l=jQuery).fn.extend({animateControl:function(t,a){return this.addClass("animated "+t).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){a&&a(),l(this).removeClass("animated "+t)}),this}})});