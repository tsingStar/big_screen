var checkstatus_timer=null,running_timer=null,gameendmessage="本轮活动已经结束,你可以刷新页面来获取新一轮活动",customerevent="shake",shakeevent=new Shake({threshold:15,timeout:300}),tips_len=THEME_INFO.themedata.tips.length;function checkstatus(){$.ajax({url:"shake.do.php?action=getstatus",type:"get",dataType:"json",success:function(t){if(t.code<0)return _loading_toast._show(t.msg),!1;if(1==t.code){if(SHAKE_CONFIG.id!=t.data.id&&window.location.reload(),SHAKE_CONFIG.status=t.status,1==t.status)return _loading_toast._show(t.msg),checkstatus_timer=setTimeout(function(){checkstatus()},3e3),!1;if(clearTimeout(checkstatus_timer),2==t.status&&startlisten(),3==t.status)return endlisten(),_loading_toast._longshow(t.msg),!1}}})}function playshakesound(){null!=typeof WeixinJSBridge?(window.shakeaudio.paused||window.shakeaudio.ended)&&window.shakeaudio.play():$(document).on("WeixinJSBridgeReady",function(){$(window.shakeaudio).load(),$(window.shakeaudio).on("canplaythrough",function(){(window.shakeaudio.paused||window.shakeaudio.ended)&&window.shakeaudio.play()})})}isbind=!1,$(function(){if(3!=SHAKE_CONFIG.status){if(-2==joingame.code)return;if(joingame.code<0)return void _loading_toast._longshow(joingame.msg)}1==SHAKE_CONFIG.status&&checkstatus(),3==SHAKE_CONFIG.status&&_loading_toast._longshow(gameendmessage),2==SHAKE_CONFIG.status&&startlisten()}),$(document).ready(function(){window.shakeaudio=$("#ShakeAudio")[0],$(document).on("WeixinJSBridgeReady",function(){$(window.shakeaudio).load()})}),window.shakeaudio=null;var startrunning=!1,stopshakingtimer=null,running=function(){playshakesound(),startrunning=!0,clearTimeout(stopshakingtimer),stopshakingtimer=setTimeout(function(){startrunning=!1},3e3)},isrunning=!1,watchrunningstatustimer=null;function watchrunningstatus(){watchrunningstatustimer=setTimeout(function(){watchrunningstatus()},3e3),0!=startrunning&&1!=isrunning&&(isrunning=!0,uploaddata().done(function(t){return t.code<=0?(_loading_toast._show(t.msg),!1):(SHAKE_CONFIG.status=t.status,1==t.status?(_loading_toast._show(t.msg),!1):2==t.status?(_loading_toast._show(THEME_INFO.themedata.tips[Math.floor(Math.random()*tips_len)]),!1):3==t.status?(_loading_toast._longshow(t.msg),endlisten(),!1):void 0)}).always(function(){isrunning=!1}))}var uploaddata=function(){return $.ajax({url:"shake.do.php?action=run",data:{userid:USERINFO.id},type:"post",dataType:"json"})};function startlisten(){0==isbind&&(shakeevent.start(),$(window).on(customerevent,running),watchrunningstatus(),isbind=!0)}function endlisten(){null!=running_timer&&clearTimeout(running_timer),null!=watchrunningstatustimer&&clearTimeout(watchrunningstatustimer),1==isbind&&($(window).off(customerevent,running),shakeevent.stop(),isbind=!1)}